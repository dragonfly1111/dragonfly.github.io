import{ZoomEvent as t,Line as e,Text as s,Rect as i,DragEvent as r}from"@leafer-ui/core";const o={toURL(t,e){let s=encodeURIComponent(t);return"text"===e?s="data:text/plain;charset=utf-8,"+s:"svg"===e&&(s="data:image/svg+xml,"+s),s},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",getRealURL(t){const{prefix:e,suffix:s}=o.image;return!s||t.startsWith("data:")||t.startsWith("blob:")||(t+=(t.includes("?")?"&":"?")+s),e&&"/"===t[0]&&(t=e+t),t}}},n={},a={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=h;return e[t]?e[t]++:(e[t]=1,0)}},h=a,{round:l,pow:d,PI:_}=Math,u={within:(t,e,s)=>("object"==typeof e&&(s=e.max,e=e.min),void 0!==e&&t<e&&(t=e),void 0!==s&&t>s&&(t=s),t),fourNumber(t,e){let s;if(t instanceof Array)switch(t.length){case 4:s=void 0===e?t:[...t];break;case 2:s=[t[0],t[1],t[0],t[1]];break;case 3:s=[t[0],t[1],t[2],t[1]];break;case 1:t=t[0];break;default:t=0}if(s||(s=[t,t,t,t]),e)for(let t=0;t<4;t++)s[t]>e&&(s[t]=e);return s},formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),u.float(t)),getGapRotation(t,e,s=0){let i=t+s;if(e>1){const t=Math.abs(i%e);(t<1||t>e-1)&&(i=Math.round(i/e)*e)}return i-s},float(t,e){const s=e?d(10,e):1e12;return-0===(t=l(t*s)/s)?0:t},getScaleData:(t,e,s,i)=>(i||(i={}),e?(i.scaleX=("number"==typeof e?e:e.width)/s.width,i.scaleY=("number"==typeof e?e:e.height)/s.height):t&&u.assignScale(i,t),i),assignScale(t,e){"number"==typeof e?t.scaleX=t.scaleY=e:(t.scaleX=e.x,t.scaleY=e.y)}},c=_/180,p=2*_,g=_/2;function y(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:f,cos:m,acos:x,sqrt:w}=Math,{float:v}=u,b={};function B(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const k={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:B(),tempMatrix:{},set(t,e=1,s=0,i=0,r=1,o=0,n=0){t.a=e,t.b=s,t.c=i,t.d=r,t.e=o,t.f=n},get:y,getWorld:B,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,s){t.e+=e,t.f+=s},translateInner(t,e,s,i){t.e+=t.a*e+t.c*s,t.f+=t.b*e+t.d*s,i&&(t.e-=e,t.f-=s)},scale(t,e,s=e){t.a*=e,t.b*=e,t.c*=s,t.d*=s},scaleOfOuter(t,e,s,i){O.toInnerPoint(t,e,b),O.scaleOfInner(t,b,s,i)},scaleOfInner(t,e,s,i=s){O.translateInner(t,e.x,e.y),O.scale(t,s,i),O.translateInner(t,-e.x,-e.y)},rotate(t,e){const{a:s,b:i,c:r,d:o}=t,n=m(e*=c),a=f(e);t.a=s*n-i*a,t.b=s*a+i*n,t.c=r*n-o*a,t.d=r*a+o*n},rotateOfOuter(t,e,s){O.toInnerPoint(t,e,b),O.rotateOfInner(t,b,s)},rotateOfInner(t,e,s){O.translateInner(t,e.x,e.y),O.rotate(t,s),O.translateInner(t,-e.x,-e.y)},skew(t,e,s){const{a:i,b:r,c:o,d:n}=t;s&&(s*=c,t.a=i+o*s,t.b=r+n*s),e&&(e*=c,t.c=o+i*e,t.d=n+r*e)},skewOfOuter(t,e,s,i){O.toInnerPoint(t,e,b),O.skewOfInner(t,b,s,i)},skewOfInner(t,e,s,i=0){O.translateInner(t,e.x,e.y),O.skew(t,s,i),O.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:s,b:i,c:r,d:o,e:n,f:a}=t;t.a=e.a*s+e.b*r,t.b=e.a*i+e.b*o,t.c=e.c*s+e.d*r,t.d=e.c*i+e.d*o,t.e=e.e*s+e.f*r+n,t.f=e.e*i+e.f*o+a},multiplyParent(t,e,s,i,r,o){let{e:n,f:a}=t;if(o&&(n+=o.scrollX,a+=o.scrollY),s||(s=t),void 0===i&&(i=1!==t.a||t.b||t.c||1!==t.d),i){const{a:i,b:o,c:n,d:a}=t;s.a=i*e.a+o*e.c,s.b=i*e.b+o*e.d,s.c=n*e.a+a*e.c,s.d=n*e.b+a*e.d,r&&(s.scaleX=e.scaleX*r.scaleX,s.scaleY=e.scaleY*r.scaleY)}else s.a=e.a,s.b=e.b,s.c=e.c,s.d=e.d,r&&(s.scaleX=e.scaleX,s.scaleY=e.scaleY);s.e=n*e.a+a*e.c+e.e,s.f=n*e.b+a*e.d+e.f},divide(t,e){O.multiply(t,O.tempInvert(e))},divideParent(t,e){O.multiplyParent(t,O.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=O;return O.copy(e,t),O.invert(e),e},invert(t){const{a:e,b:s,c:i,d:r,e:o,f:n}=t;if(s||i){const a=1/(e*r-s*i);t.a=r*a,t.b=-s*a,t.c=-i*a,t.d=e*a,t.e=-(o*r-n*i)*a,t.f=-(n*e-o*s)*a}else if(1===e&&1===r)t.e=-o,t.f=-n;else{const s=1/(e*r);t.a=r*s,t.d=e*s,t.e=-o*r*s,t.f=-n*e*s}},toOuterPoint(t,e,s,i){const{x:r,y:o}=e;s||(s=e),s.x=r*t.a+o*t.c,s.y=r*t.b+o*t.d,i||(s.x+=t.e,s.y+=t.f)},toInnerPoint(t,e,s,i){const{a:r,b:o,c:n,d:a}=t,h=1/(r*a-o*n),{x:l,y:d}=e;if(s||(s=e),s.x=(l*a-d*n)*h,s.y=(d*r-l*o)*h,!i){const{e:e,f:i}=t;s.x-=(e*a-i*n)*h,s.y-=(i*r-e*o)*h}},setLayout(t,e,s,i,r){const{x:o,y:n,scaleX:a,scaleY:h}=e;if(void 0===r&&(r=e.rotation||e.skewX||e.skewY),r){const{rotation:s,skewX:i,skewY:r}=e,o=s*c,n=m(o),l=f(o);if(i||r){const e=i*c,s=r*c;t.a=(n+s*-l)*a,t.b=(l+s*n)*a,t.c=(e*n-l)*h,t.d=(n+e*l)*h}else t.a=n*a,t.b=l*a,t.c=-l*h,t.d=n*h}else t.a=a,t.b=0,t.c=0,t.d=h;t.e=o,t.f=n,(s=s||i)&&O.translateInner(t,-s.x,-s.y,!i)},getLayout(t,e,s,i){const{a:r,b:o,c:n,d:a,e:h,f:l}=t;let d,_,u,p,y,b=h,B=l;if(o||n){const t=r*a-o*n;if(n&&!i){d=w(r*r+o*o),_=t/d;const e=r/d;u=o>0?x(e):-x(e)}else{_=w(n*n+a*a),d=t/_;const e=n/_;u=g-(a>0?x(-e):-x(e))}const e=v(m(u)),s=f(u);d=v(d),_=v(_),p=e?v((n/_+s)/e/c,9):0,y=e?v((o/d-s)/e/c,9):0,u=v(u/c)}else d=r,_=a,u=p=y=0;return(e=s||e)&&(b+=e.x*r+e.y*n,B+=e.x*o+e.y*a,s||(b-=e.x,B-=e.y)),{x:b,y:B,scaleX:d,scaleY:_,rotation:u,skewX:p,skewY:y}},withScale(t,e,s=e){const i=t;if(!e||!s){const{a:i,b:r,c:o,d:n}=t;r||o?s=(i*n-r*o)/(e=w(i*i+r*r)):(e=i,s=n)}return i.scaleX=e,i.scaleY=s,i},reset(t){O.set(t)}},O=k,{toInnerPoint:C,toOuterPoint:R}=k,{sin:T,cos:P,abs:S,sqrt:E,atan2:A,min:L,PI:I}=Math,M={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,s=0){t.x=e,t.y=s},setRadius(t,e,s){t.radiusX=e,t.radiusY=void 0===s?e:s},copy(t,e){t.x=e.x,t.y=e.y},copyFrom(t,e,s){t.x=e,t.y=s},move(t,e,s){t.x+=e,t.y+=s},scale(t,e,s=e){t.x&&(t.x*=e),t.y&&(t.y*=s)},scaleOf(t,e,s,i=s){t.x+=(t.x-e.x)*(s-1),t.y+=(t.y-e.y)*(i-1)},rotate(t,e,s){s||(s=W.defaultPoint);const i=P(e*=c),r=T(e),o=t.x-s.x,n=t.y-s.y;t.x=s.x+o*i-n*r,t.y=s.y+o*r+n*i},tempToInnerOf(t,e){const{tempPoint:s}=W;return N(s,t),C(e,s,s),s},tempToOuterOf(t,e){const{tempPoint:s}=W;return N(s,t),R(e,s,s),s},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:s}=W;return N(s,t),W.toInnerRadiusPointOf(t,e,s),s},toInnerRadiusPointOf(t,e,s){s||(s=t),C(e,t,s),s.radiusX=Math.abs(t.radiusX/e.scaleX),s.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,s){C(e,t,s)},toOuterOf(t,e,s){R(e,t,s)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getCenterX:(t,e)=>t+(e-t)/2,getCenterY:(t,e)=>t+(e-t)/2,getDistance:(t,e)=>D(t.x,t.y,e.x,e.y),getDistanceFrom(t,e,s,i){const r=S(s-t),o=S(i-e);return E(r*r+o*o)},getMinDistanceFrom:(t,e,s,i,r,o)=>L(D(t,e,s,i),D(s,i,r,o)),getAngle:(t,e)=>F(t,e)/c,getRotation:(t,e,s,i)=>(i||(i=e),W.getRadianFrom(t.x,t.y,e.x,e.y,s.x,s.y,i.x,i.y)/c),getRadianFrom(t,e,s,i,r,o,n,a){void 0===n&&(n=s,a=i);let h=A(e-i,t-s);const l=A(o-a,r-n)-h;return l<-I?l+p:l},getAtan2:(t,e)=>A(e.y-t.y,e.x-t.x),getDistancePoint(t,e,s,i){const r=F(t,e);return(e=i?e:{}).x=t.x+P(r)*s,e.y=t.y+T(r)*s,e},toNumberPoints(t){let e=t;return"object"==typeof t[0]&&(e=[],t.forEach((t=>e.push(t.x,t.y)))),e},reset(t){}},W=M,{getDistanceFrom:D,copy:N,getAtan2:F}=W;class Y{constructor(t,e){this.set(t,e)}set(t,e){return"object"==typeof t?M.copy(this,t):M.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new Y(this)}move(t,e){return M.move(this,t,e),this}scale(t,e){return M.scale(this,t,e),this}scaleOf(t,e,s){return M.scaleOf(this,t,e,s),this}rotate(t,e){return M.rotate(this,t,e),this}rotateOf(t,e){return M.rotate(this,e,t),this}getRotation(t,e,s){return M.getRotation(this,t,e,s)}toInnerOf(t,e){return M.toInnerOf(this,t,e),this}toOuterOf(t,e){return M.toOuterOf(this,t,e),this}getCenter(t){return new Y(M.getCenter(this,t))}getDistance(t){return M.getDistance(this,t)}getDistancePoint(t,e,s){return new Y(M.getDistancePoint(this,t,e,s))}getAngle(t){return M.getAngle(this,t)}getAtan2(t){return M.getAtan2(this,t)}reset(){return this}}new Y;class X{constructor(t,e,s,i,r,o){this.set(t,e,s,i,r,o)}set(t,e,s,i,r,o){return"object"==typeof t?k.copy(this,t):k.set(this,t,e,s,i,r,o),this}setWith(t){return k.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:s,d:i,e:r,f:o}=this;return{a:t,b:e,c:s,d:i,e:r,f:o}}clone(){return new X(this)}translate(t,e){return k.translate(this,t,e),this}translateInner(t,e){return k.translateInner(this,t,e),this}scale(t,e){return k.scale(this,t,e),this}scaleWith(t,e){return k.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}scaleOfOuter(t,e,s){return k.scaleOfOuter(this,t,e,s),this}scaleOfInner(t,e,s){return k.scaleOfInner(this,t,e,s),this}rotate(t){return k.rotate(this,t),this}rotateOfOuter(t,e){return k.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return k.rotateOfInner(this,t,e),this}skew(t,e){return k.skew(this,t,e),this}skewOfOuter(t,e,s){return k.skewOfOuter(this,t,e,s),this}skewOfInner(t,e,s){return k.skewOfInner(this,t,e,s),this}multiply(t){return k.multiply(this,t),this}multiplyParent(t){return k.multiplyParent(this,t),this}divide(t){return k.divide(this,t),this}divideParent(t){return k.divideParent(this,t),this}invert(){return k.invert(this),this}invertWith(){return k.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,s){k.toOuterPoint(this,t,e,s)}toInnerPoint(t,e,s){k.toInnerPoint(this,t,e,s)}setLayout(t,e,s){return k.setLayout(this,t,e,s),this}getLayout(t,e,s){return k.getLayout(this,t,e,s)}withScale(t,e){return k.withScale(this,t,e)}reset(){k.reset(this)}}new X;const z={tempPointBounds:{},setPoint(t,e,s){t.minX=t.maxX=e,t.minY=t.maxY=s},addPoint(t,e,s){t.minX=e<t.minX?e:t.minX,t.minY=s<t.minY?s:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=s>t.maxY?s:t.maxY},addBounds(t,e,s,i,r){G(t,e,s),G(t,e+i,s+r)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},addPointBounds(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:G}=z,{tempPointBounds:j,setPoint:H,addPoint:V,toBounds:U}=z,{toOuterPoint:q}=k,{float:J,fourNumber:Q}=u,{floor:Z,ceil:$}=Math;let K,tt,et,st;const it={},rt={},ot={tempBounds:{},set(t,e=0,s=0,i=0,r=0){t.x=e,t.y=s,t.width=i,t.height=r},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,s,i,r){const{x:o,y:n,width:a,height:h}=e;if(s instanceof Array){const e=Q(s);i?nt.set(t,o+e[3],n+e[0],a-e[1]-e[3],h-e[2]-e[0]):nt.set(t,o-e[3],n-e[0],a+e[1]+e[3],h+e[2]+e[0])}else i&&(s=-s),nt.set(t,o-s,n-s,a+2*s,h+2*s);r&&("width"===r?(t.y=n,t.height=h):(t.x=o,t.width=a))},minX:t=>t.width>0?t.x:t.x+t.width,minY:t=>t.height>0?t.y:t.y+t.height,maxX:t=>t.width>0?t.x+t.width:t.x,maxY:t=>t.height>0?t.y+t.height:t.y,move(t,e,s){t.x+=e,t.y+=s},getByMove:(t,e,s)=>(t=Object.assign({},t),nt.move(t,e,s),t),toOffsetOutBounds(t,e,s){e?ht(e,t):e=t,s?(e.offsetX=-(nt.maxX(s)-t.x),e.offsetY=-(nt.maxY(s)-t.y)):(e.offsetX=t.x+t.width,e.offsetY=t.y+t.height),nt.move(e,-e.offsetX,-e.offsetY)},scale(t,e,s=e){M.scale(t,e,s),t.width*=e,t.height*=s},scaleOf(t,e,s,i=s){M.scaleOf(t,e,s,i),t.width*=s,t.height*=i},tempToOuterOf:(t,e)=>(nt.copy(nt.tempBounds,t),nt.toOuterOf(nt.tempBounds,e),nt.tempBounds),getOuterOf:(t,e)=>(t=Object.assign({},t),nt.toOuterOf(t,e),t),toOuterOf(t,e,s){if(s||(s=t),0===e.b&&0===e.c){const{a:i,d:r}=e;i>0?(s.width=t.width*i,s.x=e.e+t.x*i):(s.width=t.width*-i,s.x=e.e+t.x*i-s.width),r>0?(s.height=t.height*r,s.y=e.f+t.y*r):(s.height=t.height*-r,s.y=e.f+t.y*r-s.height)}else it.x=t.x,it.y=t.y,q(e,it,rt),H(j,rt.x,rt.y),it.x=t.x+t.width,q(e,it,rt),V(j,rt.x,rt.y),it.y=t.y+t.height,q(e,it,rt),V(j,rt.x,rt.y),it.x=t.x,q(e,it,rt),V(j,rt.x,rt.y),U(j,s)},toInnerOf(t,e,s){s||(s=t),nt.move(s,-e.e,-e.f),nt.scale(s,1/e.a,1/e.d)},getFitMatrix(t,e,s=1){const i=Math.min(s,Math.min(t.width/e.width,t.height/e.height));return new X(i,0,0,i,-e.x*i,-e.y*i)},getSpread(t,e,s){const i={};return nt.copyAndSpread(i,t,e,!1,s),i},spread(t,e,s){nt.copyAndSpread(t,t,e,!1,s)},shrink(t,e,s){nt.copyAndSpread(t,t,e,!0,s)},ceil(t){const{x:e,y:s}=t;t.x=Z(t.x),t.y=Z(t.y),t.width=e>t.x?$(t.width+e-t.x):$(t.width),t.height=s>t.y?$(t.height+s-t.y):$(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},float(t,e){t.x=J(t.x,e),t.y=J(t.y,e),t.width=J(t.width,e),t.height=J(t.height,e)},add(t,e,s){K=t.x+t.width,tt=t.y+t.height,et=e.x,st=e.y,s||(et+=e.width,st+=e.height),K=K>et?K:et,tt=tt>st?tt:st,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=K-t.x,t.height=tt-t.y},addList(t,e){nt.setListWithFn(t,e,void 0,!0)},setList(t,e,s=!1){nt.setListWithFn(t,e,void 0,s)},addListWithFn(t,e,s){nt.setListWithFn(t,e,s,!0)},setListWithFn(t,e,s,i=!1){let r,o=!0;for(let n=0,a=e.length;n<a;n++)r=s?s(e[n]):e[n],r&&(r.width||r.height)&&(o?(o=!1,i||ht(t,r)):at(t,r));o&&nt.reset(t)},setPoints(t,e){e.forEach(((t,e)=>0===e?H(j,t.x,t.y):V(j,t.x,t.y))),U(j,t)},setPoint(t,e){nt.set(t,e.x,e.y)},addPoint(t,e){at(t,e,!0)},getPoints(t){const{x:e,y:s,width:i,height:r}=t;return[{x:e,y:s},{x:e+i,y:s},{x:e+i,y:s+r},{x:e,y:s+r}]},hitRadiusPoint:(t,e,s)=>(s&&(e=M.tempToInnerRadiusPointOf(e,s)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,s)=>(s&&(e=M.tempToInnerOf(e,s)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,s)=>(s&&(e=nt.tempToOuterOf(e,s)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,s)=>(s&&(e=nt.tempToOuterOf(e,s)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,s){if(s&&(e=nt.tempToOuterOf(e,s)),!nt.hit(t,e))return{x:0,y:0,width:0,height:0};let{x:i,y:r,width:o,height:n}=e;return K=i+o,tt=r+n,et=t.x+t.width,st=t.y+t.height,i=i>t.x?i:t.x,r=r>t.y?r:t.y,K=K<et?K:et,tt=tt<st?tt:st,o=K-i,n=tt-r,{x:i,y:r,width:o,height:n}},intersect(t,e,s){nt.copy(t,nt.getIntersectData(t,e,s))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,reset(t){nt.set(t)}},nt=ot,{add:at,copy:ht}=nt;class lt{get minX(){return ot.minX(this)}get minY(){return ot.minY(this)}get maxX(){return ot.maxX(this)}get maxY(){return ot.maxY(this)}constructor(t,e,s,i){this.set(t,e,s,i)}set(t,e,s,i){return"object"==typeof t?ot.copy(this,t):ot.set(this,t,e,s,i),this}get(){const{x:t,y:e,width:s,height:i}=this;return{x:t,y:e,width:s,height:i}}clone(){return new lt(this)}move(t,e){return ot.move(this,t,e),this}scale(t,e){return ot.scale(this,t,e),this}scaleOf(t,e,s){return ot.scaleOf(this,t,e,s),this}toOuterOf(t,e){return ot.toOuterOf(this,t,e),this}toInnerOf(t,e){return ot.toInnerOf(this,t,e),this}getFitMatrix(t,e){return ot.getFitMatrix(this,t,e)}spread(t,e){return ot.spread(this,t,e),this}shrink(t,e){return ot.shrink(this,t,e),this}ceil(){return ot.ceil(this),this}unsign(){return ot.unsign(this),this}float(t){return ot.float(this,t),this}add(t){return ot.add(this,t),this}addList(t){return ot.setList(this,t,!0),this}setList(t){return ot.setList(this,t),this}addListWithFn(t,e){return ot.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return ot.setListWithFn(this,t,e),this}setPoint(t){return ot.setPoint(this,t),this}setPoints(t){return ot.setPoints(this,t),this}addPoint(t){return ot.addPoint(this,t),this}getPoints(){return ot.getPoints(this)}hitPoint(t,e){return ot.hitPoint(this,t,e)}hitRadiusPoint(t,e){return ot.hitRadiusPoint(this,t,e)}hit(t,e){return ot.hit(this,t,e)}includes(t,e){return ot.includes(this,t,e)}intersect(t,e){return ot.intersect(this,t,e),this}getIntersect(t,e){return new lt(ot.getIntersectData(this,t,e))}isSame(t){return ot.isSame(this,t)}isEmpty(){return ot.isEmpty(this)}reset(){ot.reset(this)}}new lt;class dt{constructor(t,e,s,i,r,o){"object"==typeof t?this.copy(t):this.set(t,e,s,i,r,o)}set(t=0,e=0,s=0,i=0,r=0,o=0){this.top=t,this.right=e,this.bottom=s,this.left=i,this.width=r,this.height=o}copy(t){const{top:e,right:s,bottom:i,left:r,width:o,height:n}=t;this.set(e,s,i,r,o,n)}getBoundsFrom(t){const{top:e,right:s,bottom:i,left:r,width:o,height:n}=this;return new lt(r,e,o||t.width-r-s,n||t.height-e-i)}}var _t,ut;!function(t){t[t.top=0]="top",t[t.right=1]="right",t[t.bottom=2]="bottom",t[t.left=3]="left"}(_t||(_t={})),function(t){t[t.topLeft=0]="topLeft",t[t.top=1]="top",t[t.topRight=2]="topRight",t[t.right=3]="right",t[t.bottomRight=4]="bottomRight",t[t.bottom=5]="bottom",t[t.bottomLeft=6]="bottomLeft",t[t.left=7]="left",t[t.center=8]="center",t[t["top-left"]=0]="top-left",t[t["top-right"]=2]="top-right",t[t["bottom-right"]=4]="bottom-right",t[t["bottom-left"]=6]="bottom-left"}(ut||(ut={}));const ct=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];ct.forEach((t=>t.type="percent"));const pt={directionData:ct,tempPoint:{},get:gt,toPoint(t,e,s,i,r){const o=gt(t);s.x=o.x,s.y=o.y,"percent"===o.type&&(s.x*=e.width,s.y*=e.height,r&&(s.x-=r.x,s.y-=r.y,o.x&&(s.x-=1===o.x?r.width:.5===o.x?o.x*r.width:0),o.y&&(s.y-=1===o.y?r.height:.5===o.y?o.y*r.height:0))),i||(s.x+=e.x,s.y+=e.y)}};function gt(t){return"string"==typeof t?ct[ut[t]]:t}const yt={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1};class ft{constructor(t){this.repeatMap={},this.name=t}static get(t){return new ft(t)}static set filter(t){this.filterList=mt(t)}static set exclude(t){this.excludeList=mt(t)}log(...t){if(xt.enable){if(xt.filterList.length&&xt.filterList.every((t=>t!==this.name)))return;if(xt.excludeList.length&&xt.excludeList.some((t=>t===this.name)))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){xt.enable&&this.warn(...t)}warn(...t){xt.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}function mt(t){return t?"string"==typeof t&&(t=[t]):t=[],t}ft.filterList=[],ft.excludeList=[],ft.showWarn=!0;const xt=ft,wt=ft.get("RunTime"),vt={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(t,e){const s=a.create(a.RUNTIME);return bt.currentId=bt.idMap[s]=e?performance.now():Date.now(),bt.currentName=bt.nameMap[s]=t,bt.nameToIdMap[t]=s,s},end(t,e){const s=bt.idMap[t],i=bt.nameMap[t],r=e?(performance.now()-s)/1e3:Date.now()-s;bt.idMap[t]=bt.nameMap[t]=bt.nameToIdMap[i]=void 0,wt.log(i,r,"ms")},endOfName(t,e){const s=bt.nameToIdMap[t];void 0!==s&&bt.end(s,e)}},bt=vt;function Bt(t){console.error("need plugin: @leafer-in/"+t)}const kt=ft.get("UICreator"),Ot={list:{},register(t){const{__tag:e}=t.prototype;Ct[e]?kt.repeat(e):Ct[e]=t},get(t,e,s,i,r,o){const n=new Ct[t](e);return void 0!==s&&(n.x=s,i&&(n.y=i),r&&(n.width=r),o&&(n.height=o)),n}},{list:Ct}=Ot,Rt=ft.get("EventCreator"),Tt={nameList:{},register(t){let e;Object.keys(t).forEach((s=>{e=t[s],"string"==typeof e&&(Pt[e]?Rt.repeat(e):Pt[e]=t)}))},changeName(t,e){const s=Pt[t];if(s){const i=Object.keys(s).find((e=>s[e]===t));i&&(s[i]=e,Pt[e]=s)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new Pt[t](...e)},{nameList:Pt}=Tt;class St{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:s}=this;for(let i=0,r=s.length;i<r;i++)if(e=s[i],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const i=n.canvas(t);return this.add(i),i}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let s=0,i=this.list.length;s<i;s++)t=this.list[s],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach((t=>{t.destroy()})),this.list.length=0}destroy(){this.clear()}}const Et={default:(t,e)=>(At(e,t),At(t,e),t),assign(t,e){let s;Object.keys(e).forEach((i=>{var r;s=e[i],(null==s?void 0:s.constructor)===Object&&(null===(r=t[i])||void 0===r?void 0:r.constructor)===Object?At(t[i],e[i]):t[i]=e[i]}))},copyAttrs:(t,e,s)=>(s.forEach((s=>{void 0!==e[s]&&(t[s]=e[s])})),t),clone:t=>JSON.parse(JSON.stringify(t)),toMap(t){const e={};for(let s=0,i=t.length;s<i;s++)e[t[s]]=!0;return e}},{assign:At}=Et;class Lt{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&6===t.length&&1===t[0]}get __blendMode(){if(this.eraser&&"path"!==this.eraser)return"destination-out";const{blendMode:t}=this;return"pass-through"===t?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let s;for(let i in this)"_"!==i[0]&&(s=e?e[i]:void 0,t[i]=void 0===s?this[i]:s);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}if("path"!==t||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&void 0!==this.__input[t]&&(this.__input[t]=void 0)}__getInputData(t,e){const s={};if(t)if(t instanceof Array)for(let e of t)s[e]=this.__getInput(e);else for(let e in t)s[e]=this.__getInput(e);else{let t,e,{__input:i}=this;s.tag=this.__leaf.tag;for(let r in this)if("_"!==r[0]&&(t=this["_"+r],void 0!==t)){if("path"===r&&!this.__pathInputed)continue;e=i?i[r]:void 0,s[r]=void 0===e?t:e}}if(e&&e.matrix){const{a:t,b:e,c:i,d:r,e:o,f:n}=this.__leaf.__localMatrix;s.matrix={a:t,b:e,c:i,d:r,e:o,f:n}}return s}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if("pass-through"===t.blendMode){const e=this.__leaf;t.opacity<1&&e.isBranch||e.__hasEraser||t.eraser?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}var It;function Mt(t,e,s,i){var r,o=arguments.length,n=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(o<3?r(n):o>3?r(e,s,n):r(e,s))||n);return o>3&&n&&Object.defineProperty(e,s,n),n}function Wt(t,e,s,i){return new(s||(s=Promise))((function(r,o){function n(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(n,a)}h((i=i.apply(t,e||[])).next())}))}function Dt(t){return(e,s)=>{t||(t=s),Object.defineProperty(e,s,{get(){return this.context[t]},set(e){this.context[t]=e}})}}!function(t){t[t.No=0]="No",t[t.Yes=1]="Yes",t[t.NoAndSkip=2]="NoAndSkip",t[t.YesAndSkip=3]="YesAndSkip"}(It||(It={})),"function"==typeof SuppressedError&&SuppressedError;const Nt=[];function Ft(){return(t,e)=>{Nt.push(e)}}const Yt=[];let Xt=class{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||Yt)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;Nt.forEach((e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))})),this.textBaseline="alphabetic"}setTransform(t,e,s,i,r,o){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,s,i,r,o){"object"==typeof t?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,s,i,r,o)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,s,i){}strokeRect(t,e,s,i){}clearRect(t,e,s,i){}drawImage(t,e,s,i,r,o,n,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/i*a;i+=e,e=0,o+=t,a-=t}if(s<0){const t=-s/r*h;r+=s,s=0,n+=t,h-=t}this.context.drawImage(t,e,s,i,r,o,n,a,h);break;case 5:this.context.drawImage(t,e,s,i,r);break;case 3:this.context.drawImage(t,e,s)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,s,i,r,o){}quadraticCurveTo(t,e,s,i){}closePath(){}arc(t,e,s,i,r,o){}arcTo(t,e,s,i,r){}ellipse(t,e,s,i,r,o,n,a){}rect(t,e,s,i){}roundRect(t,e,s,i,r){}createConicGradient(t,e,s){}createLinearGradient(t,e,s,i){}createPattern(t,e){}createRadialGradient(t,e,s,i,r,o){}fillText(t,e,s,i){}measureText(t){}strokeText(t,e,s,i){}destroy(){this.context=null}};Mt([Dt("imageSmoothingEnabled")],Xt.prototype,"smooth",void 0),Mt([Dt("imageSmoothingQuality")],Xt.prototype,"smoothLevel",void 0),Mt([Dt("globalAlpha")],Xt.prototype,"opacity",void 0),Mt([Dt()],Xt.prototype,"fillStyle",void 0),Mt([Dt()],Xt.prototype,"strokeStyle",void 0),Mt([Dt("lineWidth")],Xt.prototype,"strokeWidth",void 0),Mt([Dt("lineCap")],Xt.prototype,"strokeCap",void 0),Mt([Dt("lineJoin")],Xt.prototype,"strokeJoin",void 0),Mt([Dt("lineDashOffset")],Xt.prototype,"dashOffset",void 0),Mt([Dt()],Xt.prototype,"miterLimit",void 0),Mt([Dt()],Xt.prototype,"shadowBlur",void 0),Mt([Dt()],Xt.prototype,"shadowColor",void 0),Mt([Dt()],Xt.prototype,"shadowOffsetX",void 0),Mt([Dt()],Xt.prototype,"shadowOffsetY",void 0),Mt([Dt()],Xt.prototype,"filter",void 0),Mt([Dt()],Xt.prototype,"font",void 0),Mt([Dt()],Xt.prototype,"fontKerning",void 0),Mt([Dt()],Xt.prototype,"fontStretch",void 0),Mt([Dt()],Xt.prototype,"fontVariantCaps",void 0),Mt([Dt()],Xt.prototype,"textAlign",void 0),Mt([Dt()],Xt.prototype,"textBaseline",void 0),Mt([Dt()],Xt.prototype,"textRendering",void 0),Mt([Dt()],Xt.prototype,"wordSpacing",void 0),Mt([Dt()],Xt.prototype,"letterSpacing",void 0),Mt([Dt()],Xt.prototype,"direction",void 0),Mt([Ft()],Xt.prototype,"setTransform",null),Mt([Ft()],Xt.prototype,"resetTransform",null),Mt([Ft()],Xt.prototype,"getTransform",null),Mt([Ft()],Xt.prototype,"save",null),Mt([Ft()],Xt.prototype,"restore",null),Mt([Ft()],Xt.prototype,"translate",null),Mt([Ft()],Xt.prototype,"scale",null),Mt([Ft()],Xt.prototype,"rotate",null),Mt([Ft()],Xt.prototype,"fill",null),Mt([Ft()],Xt.prototype,"stroke",null),Mt([Ft()],Xt.prototype,"clip",null),Mt([Ft()],Xt.prototype,"fillRect",null),Mt([Ft()],Xt.prototype,"strokeRect",null),Mt([Ft()],Xt.prototype,"clearRect",null),Mt([Ft()],Xt.prototype,"beginPath",null),Mt([Ft()],Xt.prototype,"moveTo",null),Mt([Ft()],Xt.prototype,"lineTo",null),Mt([Ft()],Xt.prototype,"bezierCurveTo",null),Mt([Ft()],Xt.prototype,"quadraticCurveTo",null),Mt([Ft()],Xt.prototype,"closePath",null),Mt([Ft()],Xt.prototype,"arc",null),Mt([Ft()],Xt.prototype,"arcTo",null),Mt([Ft()],Xt.prototype,"ellipse",null),Mt([Ft()],Xt.prototype,"rect",null),Mt([Ft()],Xt.prototype,"roundRect",null),Mt([Ft()],Xt.prototype,"createConicGradient",null),Mt([Ft()],Xt.prototype,"createLinearGradient",null),Mt([Ft()],Xt.prototype,"createPattern",null),Mt([Ft()],Xt.prototype,"createRadialGradient",null),Mt([Ft()],Xt.prototype,"fillText",null),Mt([Ft()],Xt.prototype,"measureText",null),Mt([Ft()],Xt.prototype,"strokeText",null);const zt=["width","height","pixelRatio"],Gt={creator:{},parse(t,e){},convertToCanvasData(t,e){}},jt={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Ht=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},jt),Vt={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Ut={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},qt=Object.assign(Object.assign({},Ut),jt),Jt=Ht,Qt={};for(let t in Jt)Qt[Jt[t]]=t;const Zt={};for(let t in Jt)Zt[Jt[t]]=Vt[t];const $t={drawRoundRect(t,e,s,i,r,o){const n=u.fourNumber(o,Math.min(i/2,r/2)),a=e+i,h=s+r;n[0]?t.moveTo(e+n[0],s):t.moveTo(e,s),n[1]?t.arcTo(a,s,a,h,n[1]):t.lineTo(a,s),n[2]?t.arcTo(a,h,e,h,n[2]):t.lineTo(a,h),n[3]?t.arcTo(e,h,e,s,n[3]):t.lineTo(e,h),n[0]?t.arcTo(e,s,a,s,n[0]):t.lineTo(e,s)}},{sin:Kt,cos:te,atan2:ee,ceil:se,abs:ie,PI:re,sqrt:oe,pow:ne}=Math,{setPoint:ae,addPoint:he}=z,{set:le,toNumberPoints:de}=M,{M:_e,L:ue,C:ce,Q:pe,Z:ge}=Ht,ye={},fe={points(t,e,s,i){let r=de(e);if(t.push(_e,r[0],r[1]),s&&r.length>5){let e,o,n,a,h,l,d,_,u,c,p,g,y,f=r.length;const m=!0===s?.5:s;i&&(r=[r[f-2],r[f-1],...r,r[0],r[1],r[2],r[3]],f=r.length);for(let s=2;s<f-2;s+=2)e=r[s-2],o=r[s-1],n=r[s],a=r[s+1],h=r[s+2],l=r[s+3],p=oe(ne(n-e,2)+ne(a-o,2)),g=oe(ne(h-n,2)+ne(l-a,2)),y=p+g,p=m*p/y,g=m*g/y,h-=e,l-=o,d=n-p*h,_=a-p*l,2===s?i||t.push(pe,d,_,n,a):t.push(ce,u,c,d,_,n,a),u=n+g*h,c=a+g*l;i||t.push(pe,u,c,r[f-2],r[f-1])}else for(let e=2,s=r.length;e<s;e+=2)t.push(ue,r[e],r[e+1]);i&&t.push(ge)},rect(t,e,s,i,r){Gt.creator.path=t,Gt.creator.moveTo(e,s).lineTo(e+i,s).lineTo(e+i,s+r).lineTo(e,s+r).lineTo(e,s)},roundRect(t,e,s,i,r,o){Gt.creator.path=[],$t.drawRoundRect(Gt.creator,e,s,i,r,o),t.push(...Gt.convertToCanvasData(Gt.creator.path,!0))},arcTo(t,e,s,i,r,o,n,a,h,l,d){const _=i-e,u=r-s,y=o-i,f=n-r;let m=ee(u,_),x=ee(f,y),w=x-m;if(w<0&&(w+=p),w===re||ie(_+u)<1e-12||ie(y+f)<1e-12)return t&&t.push(ue,i,r),h&&(ae(h,e,s),he(h,i,r)),d&&le(d,e,s),void(l&&le(l,i,r));const v=_*f-y*u<0,b=v?-1:1,B=a/te(w/2),k=i+B*te(m+w/2+g*b),O=r+B*Kt(m+w/2+g*b);return m-=g*b,x-=g*b,we(t,k,O,a,a,0,m/c,x/c,v,h,l,d)},arc:(t,e,s,i,r,o,n,a,h,l)=>we(t,e,s,i,i,0,r,o,n,a,h,l),ellipse(t,e,s,i,r,o,n,a,h,l,d,_){const u=o*c,y=Kt(u),f=te(u);let m=n*c,x=a*c;m>re&&(m-=p),x<0&&(x+=p);let w=x-m;w<0?w+=p:w>p&&(w-=p),h&&(w-=p);const v=se(ie(w/g)),b=w/v,B=Kt(b/4),k=8/3*B*B/Kt(b/2);x=m+b;let O,C,R,T,P,S,E,A,L=te(m),I=Kt(m),M=R=f*i*L-y*r*I,W=T=y*i*L+f*r*I,D=e+R,N=s+T;t&&t.push(t.length?ue:_e,D,N),l&&ae(l,D,N),_&&le(_,D,N);for(let o=0;o<v;o++)O=te(x),C=Kt(x),R=f*i*O-y*r*C,T=y*i*O+f*r*C,P=e+M-k*(f*i*I+y*r*L),S=s+W-k*(y*i*I-f*r*L),E=e+R+k*(f*i*C+y*r*O),A=s+T+k*(y*i*C-f*r*O),t&&t.push(ce,P,S,E,A,e+R,s+T),l&&xe(e+M,s+W,P,S,E,A,e+R,s+T,l,!0),M=R,W=T,L=O,I=C,m=x,x+=b;d&&le(d,e+R,s+T)},quadraticCurveTo(t,e,s,i,r,o,n){t.push(ce,(e+2*i)/3,(s+2*r)/3,(o+2*i)/3,(n+2*r)/3,o,n)},toTwoPointBoundsByQuadraticCurve(t,e,s,i,r,o,n,a){xe(t,e,(t+2*s)/3,(e+2*i)/3,(r+2*s)/3,(o+2*i)/3,r,o,n,a)},toTwoPointBounds(t,e,s,i,r,o,n,a,h,l){const d=[];let _,u,c,p,g,y,f,m,x=t,w=s,v=r,b=n;for(let t=0;t<2;++t)if(1==t&&(x=e,w=i,v=o,b=a),_=-3*x+9*w-9*v+3*b,u=6*x-12*w+6*v,c=3*w-3*x,Math.abs(_)<1e-12){if(Math.abs(u)<1e-12)continue;p=-c/u,0<p&&p<1&&d.push(p)}else f=u*u-4*c*_,m=Math.sqrt(f),f<0||(g=(-u+m)/(2*_),0<g&&g<1&&d.push(g),y=(-u-m)/(2*_),0<y&&y<1&&d.push(y));l?he(h,t,e):ae(h,t,e),he(h,n,a);for(let l=0,_=d.length;l<_;l++)me(d[l],t,e,s,i,r,o,n,a,ye),he(h,ye.x,ye.y)},getPointAndSet(t,e,s,i,r,o,n,a,h,l){const d=1-t,_=d*d*d,u=3*d*d*t,c=3*d*t*t,p=t*t*t;l.x=_*e+u*i+c*o+p*a,l.y=_*s+u*r+c*n+p*h},getPoint(t,e,s,i,r,o,n,a,h){const l={};return me(t,e,s,i,r,o,n,a,h,l),l}},{getPointAndSet:me,toTwoPointBounds:xe,ellipse:we}=fe,{sin:ve,cos:be,sqrt:Be,atan2:ke}=Math,{ellipse:Oe}=fe,Ce={ellipticalArc(t,e,s,i,r,n,a,h,l,d,_){const u=(l-e)/2,g=(d-s)/2,y=n*c,f=ve(y),m=be(y),x=-m*u-f*g,w=-m*g+f*u,v=i*i,b=r*r,B=w*w,k=x*x,O=v*b-v*B-b*k;let C=0;if(O<0){const t=Be(1-O/(v*b));i*=t,r*=t}else C=(a===h?-1:1)*Be(O/(v*B+b*k));const R=C*i*w/r,T=-C*r*x/i,P=ke((w-T)/r,(x-R)/i),S=ke((-w-T)/r,(-x-R)/i);let E=S-P;0===h&&E>0?E-=p:1===h&&E<0&&(E+=p);const A=e+u+m*R-f*T,L=s+g+f*R+m*T,I=E<0?1:0;_||o.ellipseToCurve?Oe(t,A,L,i,r,n,P/c,S/c,I):i!==r||n?t.push(Ht.G,A,L,i,r,n,P/c,S/c,I):t.push(Ht.O,A,L,i,P/c,S/c,I)}},{M:Re,m:Te,L:Pe,l:Se,H:Ee,h:Ae,V:Le,v:Ie,C:Me,c:We,S:De,s:Ne,Q:Fe,q:Ye,T:Xe,t:ze,A:Ge,a:je,Z:He,z:Ve,N:Ue,D:qe,X:Je,G:Qe,F:Ze,O:$e,P:Ke,U:ts}=Ht,{rect:es,roundRect:ss,arcTo:is,arc:rs,ellipse:os,quadraticCurveTo:ns}=fe,{ellipticalArc:as}=Ce,hs=ft.get("PathConvert"),ls={},ds={current:{dot:0},stringify(t,e){let s,i,r,o=0,n=t.length,a="";for(;o<n;){i=t[o],s=Zt[i],a+=i===r?" ":Qt[i];for(let i=1;i<s;i++)a+=u.float(t[o+i],e),i===s-1||(a+=" ");r=i,o+=s}return a},parse(t,e){let s,i,r,o="";const n=[],a=e?qt:Ut;for(let e=0,h=t.length;e<h;e++)i=t[e],yt[i]?("."===i&&(_s.dot&&(us(n,o),o=""),_s.dot++),"0"===o&&"."!==i&&(us(n,o),o=""),o+=i):Ht[i]?(o&&(us(n,o),o=""),_s.name=Ht[i],_s.length=Vt[i],_s.index=0,us(n,_s.name),!s&&a[i]&&(s=!0)):"-"===i||"+"===i?"e"===r||"E"===r?o+=i:(o&&us(n,o),o=i):o&&(us(n,o),o=""),r=i;return o&&us(n,o),s?ds.toCanvasData(n,e):n},toCanvasData(t,e){let s,i,r,o,n,a=0,h=0,l=0,d=0,_=0,u=t.length;const c=[];for(;_<u;){switch(r=t[_],r){case Te:t[_+1]+=a,t[_+2]+=h;case Re:a=t[_+1],h=t[_+2],c.push(Re,a,h),_+=3;break;case Ae:t[_+1]+=a;case Ee:a=t[_+1],c.push(Pe,a,h),_+=2;break;case Ie:t[_+1]+=h;case Le:h=t[_+1],c.push(Pe,a,h),_+=2;break;case Se:t[_+1]+=a,t[_+2]+=h;case Pe:a=t[_+1],h=t[_+2],c.push(Pe,a,h),_+=3;break;case Ne:t[_+1]+=a,t[_+2]+=h,t[_+3]+=a,t[_+4]+=h,r=De;case De:n=o===Me||o===De,l=n?2*a-s:t[_+1],d=n?2*h-i:t[_+2],s=t[_+1],i=t[_+2],a=t[_+3],h=t[_+4],c.push(Me,l,d,s,i,a,h),_+=5;break;case We:t[_+1]+=a,t[_+2]+=h,t[_+3]+=a,t[_+4]+=h,t[_+5]+=a,t[_+6]+=h,r=Me;case Me:s=t[_+3],i=t[_+4],a=t[_+5],h=t[_+6],c.push(Me,t[_+1],t[_+2],s,i,a,h),_+=7;break;case ze:t[_+1]+=a,t[_+2]+=h,r=Xe;case Xe:n=o===Fe||o===Xe,s=n?2*a-s:t[_+1],i=n?2*h-i:t[_+2],e?ns(c,a,h,s,i,t[_+1],t[_+2]):c.push(Fe,s,i,t[_+1],t[_+2]),a=t[_+1],h=t[_+2],_+=3;break;case Ye:t[_+1]+=a,t[_+2]+=h,t[_+3]+=a,t[_+4]+=h,r=Fe;case Fe:s=t[_+1],i=t[_+2],e?ns(c,a,h,s,i,t[_+3],t[_+4]):c.push(Fe,s,i,t[_+3],t[_+4]),a=t[_+3],h=t[_+4],_+=5;break;case je:t[_+6]+=a,t[_+7]+=h;case Ge:as(c,a,h,t[_+1],t[_+2],t[_+3],t[_+4],t[_+5],t[_+6],t[_+7],e),a=t[_+6],h=t[_+7],_+=8;break;case Ve:case He:c.push(He),_++;break;case Ue:a=t[_+1],h=t[_+2],e?es(c,a,h,t[_+3],t[_+4]):cs(c,t,_,5),_+=5;break;case qe:a=t[_+1],h=t[_+2],e?ss(c,a,h,t[_+3],t[_+4],[t[_+5],t[_+6],t[_+7],t[_+8]]):cs(c,t,_,9),_+=9;break;case Je:a=t[_+1],h=t[_+2],e?ss(c,a,h,t[_+3],t[_+4],t[_+5]):cs(c,t,_,6),_+=6;break;case Qe:os(e?c:cs(c,t,_,9),t[_+1],t[_+2],t[_+3],t[_+4],t[_+5],t[_+6],t[_+7],t[_+8],null,ls),a=ls.x,h=ls.y,_+=9;break;case Ze:e?os(c,t[_+1],t[_+2],t[_+3],t[_+4],0,0,360,!1):cs(c,t,_,5),a=t[_+1]+t[_+3],h=t[_+2],_+=5;break;case $e:rs(e?c:cs(c,t,_,7),t[_+1],t[_+2],t[_+3],t[_+4],t[_+5],t[_+6],null,ls),a=ls.x,h=ls.y,_+=7;break;case Ke:e?rs(c,t[_+1],t[_+2],t[_+3],0,360,!1):cs(c,t,_,4),a=t[_+1]+t[_+3],h=t[_+2],_+=4;break;case ts:is(e?c:cs(c,t,_,6),a,h,t[_+1],t[_+2],t[_+3],t[_+4],t[_+5],null,ls),a=ls.x,h=ls.y,_+=6;break;default:return hs.error(`command: ${r} [index:${_}]`,t),c}o=r}return c},objectToCanvasData(t){const e=[];return t.forEach((t=>{switch(t.name){case"M":e.push(Re,t.x,t.y);break;case"L":e.push(Pe,t.x,t.y);break;case"C":e.push(Me,t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"Q":e.push(Fe,t.x1,t.y1,t.x,t.y);break;case"Z":e.push(He)}})),e},copyData(t,e,s,i){for(let r=s,o=s+i;r<o;r++)t.push(e[r])},pushData(t,e){_s.index===_s.length&&(_s.index=1,t.push(_s.name)),t.push(Number(e)),_s.index++,_s.dot=0}},{current:_s,pushData:us,copyData:cs}=ds,{M:ps,L:gs,C:ys,Q:fs,Z:ms,N:xs,D:ws,X:vs,G:bs,F:Bs,O:ks,P:Os,U:Cs}=Ht,{getMinDistanceFrom:Rs,getRadianFrom:Ts}=M,{tan:Ps,min:Ss,abs:Es}=Math,As={},Ls={beginPath(t){t.length=0},moveTo(t,e,s){t.push(ps,e,s)},lineTo(t,e,s){t.push(gs,e,s)},bezierCurveTo(t,e,s,i,r,o,n){t.push(ys,e,s,i,r,o,n)},quadraticCurveTo(t,e,s,i,r){t.push(fs,e,s,i,r)},closePath(t){t.push(ms)},rect(t,e,s,i,r){t.push(xs,e,s,i,r)},roundRect(t,e,s,i,r,o){if("number"==typeof o)t.push(vs,e,s,i,r,o);else{const n=u.fourNumber(o);n?t.push(ws,e,s,i,r,...n):t.push(xs,e,s,i,r)}},ellipse(t,e,s,i,r,o,n,a,h){void 0===o?t.push(Bs,e,s,i,r):(void 0===n&&(n=0),void 0===a&&(a=360),t.push(bs,e,s,i,r,o,n,a,h?1:0))},arc(t,e,s,i,r,o,n){void 0===r?t.push(Os,e,s,i):(void 0===o&&(o=360),t.push(ks,e,s,i,r,o,n?1:0))},arcTo(t,e,s,i,r,o,n,a){if(void 0!==n){const h=Ps(Ts(n,a,e,s,i,r)/2)*(Rs(n,a,e,s,i,r)/2);t.push(Cs,e,s,i,r,Ss(o,Es(h)))}else t.push(Cs,e,s,i,r,o)},drawEllipse(t,e,s,i,r,o,n,a,h){fe.ellipse(null,e,s,i,r,void 0===o?0:o,void 0===n?0:n,void 0===a?360:a,h,null,null,As),t.push(ps,As.x,As.y),Is(t,e,s,i,r,o,n,a,h)},drawArc(t,e,s,i,r,o,n){fe.arc(null,e,s,i,void 0===r?0:r,void 0===o?360:o,n,null,null,As),t.push(ps,As.x,As.y),Ms(t,e,s,i,r,o,n)},drawPoints(t,e,s,i){fe.points(t,e,s,i)}},{ellipse:Is,arc:Ms}=Ls,{moveTo:Ws,lineTo:Ds,quadraticCurveTo:Ns,bezierCurveTo:Fs,closePath:Ys,beginPath:Xs,rect:zs,roundRect:Gs,ellipse:js,arc:Hs,arcTo:Vs,drawEllipse:Us,drawArc:qs,drawPoints:Js}=Ls;class Qs{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.set(t)}set(t){return this.__path=t?"string"==typeof t?Gt.parse(t):t:[],this}beginPath(){return Xs(this.__path),this.paint(),this}moveTo(t,e){return Ws(this.__path,t,e),this.paint(),this}lineTo(t,e){return Ds(this.__path,t,e),this.paint(),this}bezierCurveTo(t,e,s,i,r,o){return Fs(this.__path,t,e,s,i,r,o),this.paint(),this}quadraticCurveTo(t,e,s,i){return Ns(this.__path,t,e,s,i),this.paint(),this}closePath(){return Ys(this.__path),this.paint(),this}rect(t,e,s,i){return zs(this.__path,t,e,s,i),this.paint(),this}roundRect(t,e,s,i,r){return Gs(this.__path,t,e,s,i,r),this.paint(),this}ellipse(t,e,s,i,r,o,n,a){return js(this.__path,t,e,s,i,r,o,n,a),this.paint(),this}arc(t,e,s,i,r,o){return Hs(this.__path,t,e,s,i,r,o),this.paint(),this}arcTo(t,e,s,i,r){return Vs(this.__path,t,e,s,i,r),this.paint(),this}drawEllipse(t,e,s,i,r,o,n,a){return Us(this.__path,t,e,s,i,r,o,n,a),this.paint(),this}drawArc(t,e,s,i,r,o){return qs(this.__path,t,e,s,i,r,o),this.paint(),this}drawPoints(t,e,s){return Js(this.__path,t,e,s),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:Zs,L:$s,C:Ks,Q:ti,Z:ei,N:si,D:ii,X:ri,G:oi,F:ni,O:ai,P:hi,U:li}=Ht,di=ft.get("PathDrawer"),_i={drawPathByData(t,e){if(!e)return;let s,i=0,r=e.length;for(;i<r;)switch(s=e[i],s){case Zs:t.moveTo(e[i+1],e[i+2]),i+=3;break;case $s:t.lineTo(e[i+1],e[i+2]),i+=3;break;case Ks:t.bezierCurveTo(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5],e[i+6]),i+=7;break;case ti:t.quadraticCurveTo(e[i+1],e[i+2],e[i+3],e[i+4]),i+=5;break;case ei:t.closePath(),i+=1;break;case si:t.rect(e[i+1],e[i+2],e[i+3],e[i+4]),i+=5;break;case ii:t.roundRect(e[i+1],e[i+2],e[i+3],e[i+4],[e[i+5],e[i+6],e[i+7],e[i+8]]),i+=9;break;case ri:t.roundRect(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5]),i+=6;break;case oi:t.ellipse(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5]*c,e[i+6]*c,e[i+7]*c,e[i+8]),i+=9;break;case ni:t.ellipse(e[i+1],e[i+2],e[i+3],e[i+4],0,0,p,!1),i+=5;break;case ai:t.arc(e[i+1],e[i+2],e[i+3],e[i+4]*c,e[i+5]*c,e[i+6]),i+=7;break;case hi:t.arc(e[i+1],e[i+2],e[i+3],0,p,!1),i+=4;break;case li:t.arcTo(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5]),i+=6;break;default:return void di.error(`command: ${s} [index:${i}]`,e)}}},{M:ui,L:ci,C:pi,Q:gi,Z:yi,N:fi,D:mi,X:xi,G:wi,F:vi,O:bi,P:Bi,U:ki}=Ht,{toTwoPointBounds:Oi,toTwoPointBoundsByQuadraticCurve:Ci,arcTo:Ri,arc:Ti,ellipse:Pi}=fe,{addPointBounds:Si,copy:Ei,addPoint:Ai,setPoint:Li,addBounds:Ii,toBounds:Mi}=z,Wi=ft.get("PathBounds");let Di,Ni,Fi;const Yi={},Xi={},zi={},Gi={toBounds(t,e){Gi.toTwoPointBounds(t,Xi),Mi(Xi,e)},toTwoPointBounds(t,e){if(!t||!t.length)return Li(e,0,0);let s,i,r,o,n,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(n=t[a],0===a&&(n===yi||n===pi||n===gi?Li(e,h,l):Li(e,t[a+1],t[a+2])),n){case ui:case ci:h=t[a+1],l=t[a+2],Ai(e,h,l),a+=3;break;case pi:r=t[a+5],o=t[a+6],Oi(h,l,t[a+1],t[a+2],t[a+3],t[a+4],r,o,Yi),Si(e,Yi),h=r,l=o,a+=7;break;case gi:s=t[a+1],i=t[a+2],r=t[a+3],o=t[a+4],Ci(h,l,s,i,r,o,Yi),Si(e,Yi),h=r,l=o,a+=5;break;case yi:a+=1;break;case fi:h=t[a+1],l=t[a+2],Ii(e,h,l,t[a+3],t[a+4]),a+=5;break;case mi:case xi:h=t[a+1],l=t[a+2],Ii(e,h,l,t[a+3],t[a+4]),a+=n===mi?9:6;break;case wi:Pi(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],Yi,zi),0===a?Ei(e,Yi):Si(e,Yi),h=zi.x,l=zi.y,a+=9;break;case vi:h=t[a+1],l=t[a+2],Ni=t[a+3],Fi=t[a+4],Ii(e,h-Ni,l-Fi,2*Ni,2*Fi),h+=Ni,a+=5;break;case bi:Ti(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],Yi,zi),0===a?Ei(e,Yi):Si(e,Yi),h=zi.x,l=zi.y,a+=7;break;case Bi:h=t[a+1],l=t[a+2],Di=t[a+3],Ii(e,h-Di,l-Di,2*Di,2*Di),h+=Di,a+=4;break;case ki:Ri(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],Yi,zi),0===a?Ei(e,Yi):Si(e,Yi),h=zi.x,l=zi.y,a+=6;break;default:return void Wi.error(`command: ${n} [index:${a}]`,t)}}},{M:ji,L:Hi,C:Vi,Z:Ui}=Ht,{getCenterX:qi,getCenterY:Ji}=M,{arcTo:Qi}=Ls,Zi={smooth(t,e,s){let i,r=0,o=0,n=0,a=0,h=0,l=0,d=0,_=0,u=0;const c=t.length,p=[];for(;r<c;)switch(i=t[r],i){case ji:a=_=t[r+1],h=u=t[r+2],r+=3,t[r]===Hi?(l=t[r+1],d=t[r+2],p.push(ji,qi(a,l),Ji(h,d))):p.push(ji,a,h);break;case Hi:switch(o=t[r+1],n=t[r+2],r+=3,t[r]){case Hi:Qi(p,o,n,t[r+1],t[r+2],e,_,u);break;case Ui:Qi(p,o,n,a,h,e,_,u);break;default:p.push(Hi,o,n)}_=o,u=n;break;case Vi:p.push(Vi,t[r+1],t[r+2],t[r+3],t[r+4],t[r+5],t[r+6]),r+=7;break;case Ui:Qi(p,a,h,l,d,e,_,u),p.push(Ui),r+=1}return i!==Ui&&(p[1]=a,p[2]=h),p}};Gt.creator=new Qs,Gt.parse=ds.parse,Gt.convertToCanvasData=ds.toCanvasData;const $i=new Qs,Ki={opacityTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]},isOpaqueImage(t){const e=tr.fileType(t);return["jpg","jpeg"].some((t=>t===e))},getExportOptions(t){switch(typeof t){case"object":return t;case"number":return{quality:t};case"boolean":return{blob:t};default:return{}}}},tr=Ki;tr.opacityTypes.forEach((t=>tr.upperCaseTypeMap[t]=t.toUpperCase()));const er=ft.get("TaskProcessor");class sr{constructor(t){this.parallel=!0,this.time=1,this.id=a.create(a.TASK),this.task=t}run(){return Wt(this,void 0,void 0,(function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){er.error(t)}}))}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class ir{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,s=0;for(let i=0;i<t;i++)i<=this.finishedIndex?(s+=this.list[i].time,i===this.finishedIndex&&(e=s)):e+=this.list[i].time;return this.isComplete?1:s/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&Et.assign(this.config,t),this.empty()}add(t,e){let s,i,r,o;const n=new sr(t);return n.parent=this,"number"==typeof e?o=e:e&&(i=e.parallel,s=e.start,r=e.time,o=e.delay),r&&(n.time=r),!1===i&&(n.parallel=!1),void 0===o?this.push(n,s):(this.delayNumber++,setTimeout((()=>{this.delayNumber&&(this.delayNumber--,this.push(n,s))}),o)),this.isComplete=!1,n}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout((()=>this.start())))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach((t=>{t.isComplete||t.cancel()})),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then((()=>{this.onTask(t),this.index++,this.nextTask()})).catch((t=>{this.onError(t)})):this.nextTask()}runParallelTasks(){this.parallelList.forEach((t=>this.runParallelTask(t)))}runParallelTask(t){t.run().then((()=>{this.onTask(t),this.fillParallelTask()})).catch((t=>{this.onParallelError(t)}))}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout((()=>this.run()))}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let e=this.index+this.config.parallel;e>this.list.length&&(e=this.list.length);for(let s=this.index;s<e&&(t=this.list[s],t.parallel);s++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const s=e.length,i=this.finishedIndex+s;if(e.length){if(!this.running)return;i<this.total&&(t=this.list[i],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach((t=>{t.parallel=!1})),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const rr={map:{},recycledList:[],tasker:new ir,patternTasker:new ir,get isComplete(){return or.tasker.isComplete},get(t){let e=or.map[t.url];return e||(e=n.image(t),or.map[t.url]=e),e.use++,e},recycle(t){t.use--,setTimeout((()=>{t.use||or.recycledList.push(t)}))},clearRecycled(){const t=or.recycledList;t.length>100&&(t.forEach((t=>{!t.use&&t.url&&(delete or.map[t.url],t.destroy())})),t.length=0)},hasOpacityPixel:t=>Ki.opacityTypes.some((e=>or.isFormat(e,t))),isFormat(t,e){if(e.format===t)return!0;const{url:s}=e;if(s.startsWith("data:")){if(s.startsWith("data:"+Ki.mineType(t)))return!0}else{if(s.includes("."+t)||s.includes("."+Ki.upperCaseTypeMap[t]))return!0;if("png"===t&&!s.includes("."))return!0}return!1},destroy(){or.map={},or.recycledList=[]}},or=rr,{IMAGE:nr,create:ar}=a;class hr{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){this.use=0,this.waitComplete=[],this.innerId=ar(nr),this.config=t||{url:""},this.isSVG=rr.isFormat("svg",t),this.hasOpacityPixel=rr.hasOpacityPixel(t)}load(t,e){return this.loading||(this.loading=!0,rr.tasker.add((()=>Wt(this,void 0,void 0,(function*(){return yield o.origin.loadImage(this.url).then((t=>{this.ready=!0,this.width=t.naturalWidth||t.width,this.height=t.naturalHeight||t.height,this.view=t,this.onComplete(!0)})).catch((t=>{this.error=t,this.onComplete(!1)}))}))))),this.waitComplete.push(t,e),this.waitComplete.length-2}unload(t,e){const s=this.waitComplete;if(e){const e=s[t+1];e&&e({type:"stop"})}s[t]=s[t+1]=void 0}onComplete(t){let e;this.waitComplete.forEach(((s,i)=>{e=i%2,s&&(t?e||s(this):e&&s(this.error))})),this.waitComplete.length=0,this.loading=!1}getCanvas(t,e,s,i){if(t||(t=this.width),e||(e=this.height),this.cache){let{params:t,data:e}=this.cache;for(let s in t)if(t[s]!==arguments[s]){e=null;break}if(e)return e}const r=o.origin.createCanvas(t,e),n=r.getContext("2d");return s&&(n.globalAlpha=s),n.drawImage(this.view,0,0,t,e),this.cache=this.use>1?{data:r,params:arguments}:null,r}getPattern(t,e,s,i){const r=o.canvas.createPattern(t,e);try{s&&r.setTransform&&(r.setTransform(s),s=null)}catch(t){}return i&&(i.transform=s),r}destroy(){this.config={url:""},this.cache=null,this.waitComplete.length=0}}function lr(t,e,s,i){i||(s.configurable=s.enumerable=!0),Object.defineProperty(t,e,s)}function dr(t,e){return Object.getOwnPropertyDescriptor(t,e)}function _r(t,e){return(s,i)=>function(t,e,s,i){const r={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)}};lr(t,e,Object.assign(r,i||{})),Tr(t,e,s)}(s,i,t,e&&e(i))}function ur(t){return _r(t)}function cr(t,e){return _r(t,(t=>({set(s){this.__setAttr(t,s,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}})))}function pr(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal())}})))}function gr(t,e){return _r(t,(t=>({set(s){this.__setAttr(t,s,e)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}})))}function yr(t,e){return _r(t,(t=>({set(s){this.__setAttr(t,s,e)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}})))}function fr(t,e){return _r(t,(t=>({set(s){this.__setAttr(t,s,e)&&mr(this)}})))}function mr(t){t.__layout.boxChanged||t.__layout.boxChange(),t.__hasAutoLayout&&(t.__layout.matrixChanged||t.__layout.matrixChange())}const xr=fr;function wr(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&vr(this)}})))}function vr(t){t.__layout.strokeChanged||t.__layout.strokeChange(),t.__.__useArrow&&mr(t)}const br=wr;function Br(t){return _r(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}})))}function kr(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}})))}function Or(t,e,s,i){t.__setAttr(e,s)&&(t.__layout.opacityChanged||t.__layout.opacityChange(),0!==i&&0!==s||mr(t))}function Cr(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,ft.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange()),this.leafer&&this.leafer.updateCursor())}})))}function Rr(t){return(e,s)=>{lr(e,"__DataProcessor",{get:()=>t})}}function Tr(t,e,s){const i=t.__DataProcessor.prototype,r="_"+e,o=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),n={get(){const t=this[r];return void 0===t?s:t},set(t){this[r]=t}};if(void 0===s)n.get=function(){return this[r]};else if("object"==typeof s){const{clone:t}=Et;n.get=function(){let e=this[r];return void 0===e&&(this[r]=e=t(s)),e}}"width"===e?n.get=function(){const t=this[r];if(void 0===t){const t=this;return t._height&&t.__naturalWidth&&t.__useNaturalRatio?t._height*t.__naturalWidth/t.__naturalHeight:t.__naturalWidth||s}return t}:"height"===e&&(n.get=function(){const t=this[r];if(void 0===t){const t=this;return t._width&&t.__naturalHeight&&t.__useNaturalRatio?t._width*t.__naturalHeight/t.__naturalWidth:t.__naturalHeight||s}return t});let a,h=i;for(;!a&&h;)a=dr(h,e),h=h.__proto__;a&&a.set&&(n.set=a.set),i[o]&&(n.set=i[o],delete i[o]),lr(i,e,n)}const Pr=new ft("rewrite"),Sr=[],Er=["destroy","constructor"];function Ar(t){return(e,s)=>{Sr.push({name:e.constructor.name+"."+s,run:()=>{e[s]=t}})}}function Lr(){return t=>{Ir()}}function Ir(t){Sr.length&&(Sr.forEach((e=>{t&&Pr.error(e.name,"需在Class上装饰@rewriteAble()"),e.run()})),Sr.length=0)}function Mr(t,e){return s=>{var i;(t.prototype?(i=t.prototype,Object.getOwnPropertyNames(i)):Object.keys(t)).forEach((i=>{if(!(Er.includes(i)||e&&e.includes(i)))if(t.prototype){dr(t.prototype,i).writable&&(s.prototype[i]=t.prototype[i])}else s.prototype[i]=t[i]}))}}function Wr(){return t=>{Ot.register(t)}}setTimeout((()=>Ir(!0)));const{copy:Dr,toInnerPoint:Nr,toOuterPoint:Fr,scaleOfOuter:Yr,rotateOfOuter:Xr,skewOfOuter:zr,multiplyParent:Gr,divideParent:jr,getLayout:Hr}=k,Vr={},Ur={updateAllMatrix(t,e,s){if(e&&t.__hasAutoLayout&&t.__layout.matrixChanged&&(s=!0),Qr(t,e,s),t.isBranch){const{children:i}=t;for(let t=0,r=i.length;t<r;t++)Jr(i[t],e,s)}},updateMatrix(t,e,s){const i=t.__layout;e?s&&(i.waitAutoLayout=!0,t.__hasAutoLayout&&(i.matrixChanged=!1)):i.waitAutoLayout&&(i.waitAutoLayout=!1),i.matrixChanged&&t.__updateLocalMatrix(),i.waitAutoLayout||t.__updateWorldMatrix()},updateBounds(t){const e=t.__layout;e.boundsChanged&&t.__updateLocalBounds(),e.waitAutoLayout||t.__updateWorldBounds()},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,s=e.length;t<s;t++)Zr(e[t])}},updateAllChange(t){if(Zr(t),t.__updateChange(),t.isBranch){const{children:e}=t;for(let t=0,s=e.length;t<s;t++)$r(e[t])}},worldHittable(t){for(;t;){if(!t.__.hittable)return!1;t=t.parent}return!0},moveWorld(t,e,s=0,i){const r="object"==typeof e?Object.assign({},e):{x:e,y:s};i?Fr(t.localTransform,r,r,!0):t.parent&&Nr(t.parent.worldTransform,r,r,!0),qr.moveLocal(t,r.x,r.y)},moveLocal(t,e,s=0){"object"==typeof e?(t.x+=e.x,t.y+=e.y):(t.x+=e,t.y+=s)},zoomOfWorld(t,e,s,i,r){qr.zoomOfLocal(t,to(t,e),s,i,r)},zoomOfLocal(t,e,s,i=s,r){Dr(Vr,t.__localMatrix),Yr(Vr,e,s,i),t.origin||t.around?qr.setTransform(t,Vr,r):(Kr(t,Vr),t.scaleResize(s,i,!0!==r))},rotateOfWorld(t,e,s){qr.rotateOfLocal(t,to(t,e),s)},rotateOfLocal(t,e,s){Dr(Vr,t.__localMatrix),Xr(Vr,e,s),t.origin||t.around?qr.setTransform(t,Vr):(Kr(t,Vr),t.rotation=u.formatRotation(t.rotation+s))},skewOfWorld(t,e,s,i,r){qr.skewOfLocal(t,to(t,e),s,i,r)},skewOfLocal(t,e,s,i=0,r){Dr(Vr,t.__localMatrix),zr(Vr,e,s,i),qr.setTransform(t,Vr,r)},transformWorld(t,e,s){Dr(Vr,t.worldTransform),Gr(Vr,e),t.parent&&jr(Vr,t.parent.worldTransform),qr.setTransform(t,Vr,s)},transform(t,e,s){Dr(Vr,t.localTransform),Gr(Vr,e),qr.setTransform(t,Vr,s)},setTransform(t,e,s){const i=Hr(e,t.origin&&qr.getInnerOrigin(t,t.origin),t.around&&qr.getInnerOrigin(t,t.around));if(s){const e=i.scaleX/t.scaleX,r=i.scaleY/t.scaleY;delete i.scaleX,delete i.scaleY,t.set(i),t.scaleResize(e,r,!0!==s)}else t.set(i)},getFlipTransform(t,e){const s={a:1,b:0,c:0,d:1,e:0,f:0},i="x"===e?1:-1;return Yr(s,qr.getLocalOrigin(t,"center"),-1*i,1*i),s},getLocalOrigin:(t,e)=>M.tempToOuterOf(qr.getInnerOrigin(t,e),t.localTransform),getInnerOrigin(t,e){const s={};return pt.toPoint(e,t.boxBounds,s),s},getRelativeWorld:(t,e,s)=>(Dr(Vr,t.worldTransform),jr(Vr,e.worldTransform),s?Vr:Object.assign({},Vr)),drop(t,e,s,i){t.setTransform(qr.getRelativeWorld(t,e,!0),i),e.add(t,s)},hasParent(t,e){if(!e)return!1;for(;t;){if(e===t)return!0;t=t.parent}}},qr=Ur,{updateAllMatrix:Jr,updateMatrix:Qr,updateAllWorldOpacity:Zr,updateAllChange:$r}=qr;function Kr(t,e){const{e:s,f:i}=t.__localMatrix;t.x+=e.e-s,t.y+=e.f-i}function to(t,e){return t.__layout.update(),t.parent?M.tempToInnerOf(e,t.parent.__world):e}const eo={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.eraser||0===t.__.visible?null:t.__local||t.__layout,localStrokeBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localRenderBounds,maskLocalBoxBounds:t=>t.__.mask?t.__localBoxBounds:null,maskLocalStrokeBounds:t=>t.__.mask?t.__layout.localStrokeBounds:null,maskLocalRenderBounds:t=>t.__.mask?t.__layout.localRenderBounds:null,excludeRenderBounds:(t,e)=>!(!e.bounds||e.bounds.hit(t.__world,e.matrix))||!(!e.hideBounds||!e.hideBounds.includes(t.__world,e.matrix))},{updateBounds:so}=Ur,io={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:s}=t;for(let i=0,r=s.length;i<r;i++)(t=s[i]).isBranch&&(t.__tempNumber=1,e.add(t),ro(t,e))}},pushAllParent(t,e){const{keys:s}=e;if(s)for(;t.parent&&void 0===s[t.parent.innerId];)e.add(t.parent),t=t.parent;else for(;t.parent;)e.add(t.parent),t=t.parent},pushAllBranchStack(t,e){let s=e.length;const{children:i}=t;for(let t=0,s=i.length;t<s;t++)i[t].isBranch&&e.push(i[t]);for(let t=s,i=e.length;t<i;t++)oo(e[t],e)},updateBounds(t,e){const s=[t];oo(t,s),no(s,e)},updateBoundsByBranchStack(t,e){let s,i;for(let r=t.length-1;r>-1;r--){s=t[r],i=s.children;for(let t=0,e=i.length;t<e;t++)so(i[t]);e&&e===s||so(s)}}},{pushAllChildBranch:ro,pushAllBranchStack:oo,updateBoundsByBranchStack:no}=io,ao={run(t){if(t&&t.length){const e=t.length;for(let s=0;s<e;s++)t[s]();t.length===e?t.length=0:t.splice(0,e)}}},{getRelativeWorld:ho}=Ur,{toOuterOf:lo,getPoints:_o,copy:uo}=ot,co="_localContentBounds",po="_worldContentBounds",go="_worldBoxBounds",yo="_worldStrokeBounds";class fo{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}get localContentBounds(){return lo(this.contentBounds,this.leaf.__localMatrix,this[co]||(this[co]={})),this[co]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return lo(this.contentBounds,this.leaf.__world,this[po]||(this[po]={})),this[po]}get worldBoxBounds(){return lo(this.boxBounds,this.leaf.__world,this[go]||(this[go]={})),this[go]}get worldStrokeBounds(){return lo(this.strokeBounds,this.leaf.__world,this[yo]||(this[yo]={})),this[yo]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.boxBounds={x:0,y:0,width:0,height:0},this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),this.boxChange(),this.matrixChange()}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leafer:t}=this.leaf;if(t)t.ready?t.watcher.changed&&t.layouter.layout():t.start();else{let t=this.leaf;for(;t.parent&&!t.parent.leafer;)t=t.parent;o.layout(t)}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return k.defaultMatrix;case"page":t=e.zoomLayer;default:return ho(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new lt(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",s){const{leaf:i}=this;let r,o,n,a=this.getInnerBounds(t);switch(e){case"world":r=i.getWorldPoint(a),o=i.__world;break;case"local":const{scaleX:t,scaleY:s,rotation:h,skewX:l,skewY:d}=i.__;n={scaleX:t,scaleY:s,rotation:h,skewX:l,skewY:d},r=i.getLocalPointByInner(a);break;case"inner":r=a,o=k.defaultMatrix;break;case"page":e=i.zoomLayer;default:r=i.getWorldPoint(a,e),o=ho(i,e,!0)}if(n||(n=k.getLayout(o)),uo(n,a),M.copy(n,r),s){const{scaleX:t,scaleY:e}=n,s=Math.abs(t),i=Math.abs(e);1===s&&1===i||(n.scaleX/=s,n.scaleY/=i,n.width*=s,n.height*=i)}return n}getLayoutPoints(t,e="world"){const{leaf:s}=this,i=_o(this.getInnerBounds(t));let r;switch(e){case"world":r=null;break;case"local":r=s.parent;break;case"inner":break;case"page":e=s.zoomLayer;default:r=e}return void 0!==r&&i.forEach((t=>s.innerToWorld(t,null,!1,r))),i}shrinkContent(){const{x:t,y:e,width:s,height:i}=this.boxBounds;this._contentBounds={x:t,y:e,width:s,height:i}}spreadStroke(){const{x:t,y:e,width:s,height:i}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:s,height:i},this._localStrokeBounds={x:t,y:e,width:s,height:i},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:s,height:i}=this.renderBounds;this._renderBounds={x:t,y:e,width:s,height:i},this._localRenderBounds={x:t,y:e,width:s,height:i}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class mo{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&o.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&o.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&o.event.stop(this.origin)}}class xo extends mo{constructor(t,e,s){super(t,e),this.parent=s,this.child=e}}xo.ADD="child.add",xo.REMOVE="child.remove",xo.CREATED="created",xo.MOUNTED="mounted",xo.UNMOUNTED="unmounted",xo.DESTROY="destroy";class wo extends mo{constructor(t,e,s,i,r){super(t,e),this.attrName=s,this.oldValue=i,this.newValue=r}}wo.CHANGE="property.change",wo.LEAFER_CHANGE="property.leafer_change";class vo extends mo{constructor(t,e){super(t),Object.assign(this,e)}}vo.LOAD="image.load",vo.LOADED="image.loaded",vo.ERROR="image.error";class bo extends mo{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){"object"==typeof t?(super(bo.RESIZE),Object.assign(this,t)):super(t),this.old=e}}bo.RESIZE="resize";class Bo extends mo{constructor(t,e){super(t),this.data=e}}Bo.REQUEST="watch.request",Bo.DATA="watch.data";class ko extends mo{constructor(t,e,s){super(t),e&&(this.data=e,this.times=s)}}ko.CHECK_UPDATE="layout.check_update",ko.REQUEST="layout.request",ko.START="layout.start",ko.BEFORE="layout.before",ko.LAYOUT="layout",ko.AFTER="layout.after",ko.AGAIN="layout.again",ko.END="layout.end";class Oo extends mo{constructor(t,e,s,i){super(t),e&&(this.times=e),s&&(this.renderBounds=s,this.renderOptions=i)}}Oo.REQUEST="render.request",Oo.CHILD_START="render.child_start",Oo.START="render.start",Oo.BEFORE="render.before",Oo.RENDER="render",Oo.AFTER="render.after",Oo.AGAIN="render.again",Oo.END="render.end",Oo.NEXT="render.next";class Co extends mo{}Co.START="leafer.start",Co.BEFORE_READY="leafer.before_ready",Co.READY="leafer.ready",Co.AFTER_READY="leafer.after_ready",Co.VIEW_READY="leafer.view_ready",Co.VIEW_COMPLETED="leafer.view_completed",Co.STOP="leafer.stop",Co.RESTART="leafer.restart",Co.END="leafer.end";const Ro={};function To(t,e,s){if(e){const{__captureMap:e}=t;return e||(s?t.__captureMap={}:Ro)}{const{__bubbleMap:e}=t;return e||(s?t.__bubbleMap={}:Ro)}}const{on:Po,on_:So,off:Eo,off_:Ao,once:Lo,emit:Io,emitEvent:Mo,hasEvent:Wo,destroy:Do}=class{set event(t){this.on(t)}on(t,e,s){if(!e){let e,s=t;for(let t in s)e=s[t],e instanceof Array?this.on(t,e[0],e[1]):this.on(t,e);return}let i,r,o;s&&("once"===s?r=!0:"boolean"==typeof s?i=s:(i=s.capture,r=s.once));const n=To(this,i,!0),a="string"==typeof t?t.split(" "):t,h=r?{listener:e,once:r}:{listener:e};a.forEach((t=>{t&&(o=n[t],o?-1===o.findIndex((t=>t.listener===e))&&o.push(h):n[t]=[h])}))}off(t,e,s){if(t){const i="string"==typeof t?t.split(" "):t;if(e){let t,r,o;s&&(t="boolean"==typeof s?s:"once"!==s&&s.capture);const n=To(this,t);i.forEach((t=>{t&&(r=n[t],r&&(o=r.findIndex((t=>t.listener===e)),o>-1&&r.splice(o,1),r.length||delete n[t]))}))}else{const{__bubbleMap:t,__captureMap:e}=this;i.forEach((s=>{t&&delete t[s],e&&delete e[s]}))}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,e,s,i){return s&&(e=e.bind(s)),this.on(t,e,i),{type:t,current:this,listener:e,options:i}}off_(t){if(!t)return;const e=t instanceof Array?t:[t];e.forEach((t=>t.current.off(t.type,t.listener,t.options))),e.length=0}once(t,e,s){this.on(t,e,{once:!0,capture:s})}emit(t,e,s){!e&&Tt.has(t)&&(e=Tt.get(t,{type:t,target:this,current:this}));const i=To(this,s)[t];if(i){let r;for(let o=0,n=i.length;o<n&&(r=i[o],r.listener(e),r.once&&(this.off(t,r.listener,s),o--,n--),!e||!e.isStopNow);o++);}this.syncEventer&&this.syncEventer.emitEvent(e,s)}emitEvent(t,e){t.current=this,this.emit(t.type,t,e)}hasEvent(t,e){if(this.syncEventer&&this.syncEventer.hasEvent(t,e))return!0;const{__bubbleMap:s,__captureMap:i}=this,r=s&&s[t],o=i&&i[t];return!!(void 0===e?r||o:e?o:r)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}.prototype,No={on:Po,on_:So,off:Eo,off_:Ao,once:Lo,emit:Io,emitEvent:Mo,hasEvent:Wo,destroyEventer:Do},{isFinite:Fo}=Number,Yo=ft.get("setAttr"),Xo={__setAttr(t,e,s){if(this.leaferIsCreated){const i=this.__.__getInput(t);if(s&&!Fo(e)&&void 0!==e&&(Yo.warn(this.innerName,t,e),e=void 0),"object"==typeof e||i!==e){this.__realSetAttr(t,e);const{CHANGE:s}=wo,r=new wo(s,this,t,i,e);return this.isLeafer?this.emitEvent(new wo(wo.LEAFER_CHANGE,this,t,i,e)):this.hasEvent(s)&&this.emitEvent(r),this.leafer.emitEvent(r),!0}return!1}return this.__realSetAttr(t,e),!0},__realSetAttr(t,e){const s=this.__;s[t]=e,this.__proxyData&&this.setProxyAttr(t,e),s.normalStyle&&(this.lockNormalStyle||void 0===s.normalStyle[t]||(s.normalStyle[t]=e))},__getAttr(t){return this.__proxyData?this.getProxyAttr(t):this.__.__get(t)}},{setLayout:zo,multiplyParent:Go,translateInner:jo,defaultWorld:Ho}=k,{toPoint:Vo,tempPoint:Uo}=pt,qo={__updateWorldMatrix(){Go(this.__local||this.__layout,this.parent?this.parent.__world:Ho,this.__world,!!this.__layout.affectScaleOrRotation,this.__,this.parent&&this.parent.__)},__updateLocalMatrix(){if(this.__local){const t=this.__layout,e=this.__local,s=this.__;t.affectScaleOrRotation&&(t.scaleChanged||t.rotationChanged)&&(zo(e,s,null,null,t.affectRotation),t.scaleChanged=t.rotationChanged=!1),e.e=s.x+s.offsetX,e.f=s.y+s.offsetY,(s.around||s.origin)&&(Vo(s.around||s.origin,t.boxBounds,Uo),jo(e,-Uo.x,-Uo.y,!s.around))}this.__layout.matrixChanged=!1}},{updateMatrix:Jo,updateAllMatrix:Qo}=Ur,{updateBounds:Zo}=io,{toOuterOf:$o,copyAndSpread:Ko,copy:tn}=ot,{toBounds:en}=Gi,sn={__updateWorldBounds(){$o(this.__layout.renderBounds,this.__world,this.__world),this.__layout.resized&&(this.__onUpdateSize(),this.__layout.resized=!1)},__updateLocalBounds(){const t=this.__layout;t.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),t.resized=!0),t.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),t.localBoxChanged=!1,t.strokeSpread&&(t.strokeChanged=!0),t.renderSpread&&(t.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),t.boxChanged=!1,t.strokeChanged&&(t.strokeSpread=this.__updateStrokeSpread(),t.strokeSpread?(t.strokeBounds===t.boxBounds&&t.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):t.spreadStrokeCancel(),t.strokeChanged=!1,(t.renderSpread||t.strokeSpread!==t.strokeBoxSpread)&&(t.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t.resized=!0),t.renderChanged&&(t.renderSpread=this.__updateRenderSpread(),t.renderSpread?(t.renderBounds!==t.boxBounds&&t.renderBounds!==t.strokeBounds||t.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):t.spreadRenderCancel(),t.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),t.boundsChanged=!1},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),$o(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){$o(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){$o(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(){const t=this.__layout.boxBounds,e=this.__;e.__pathInputed?en(e.path,t):(t.x=0,t.y=0,t.width=e.width,t.height=e.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.leaferIsReady&&this.leafer.layouter.addExtra(this),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),Qo(this),Zo(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(Qo(this),Zo(this,this))):Jo(this)},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height},__updateStrokeBounds(){const t=this.__layout;Ko(t.strokeBounds,t.boxBounds,t.strokeBoxSpread)},__updateRenderBounds(){const t=this.__layout;t.renderSpread>0?Ko(t.renderBounds,t.boxBounds,t.renderSpread):tn(t.renderBounds,t.strokeBounds)}},rn={__render(t,e){if(this.__worldOpacity)if(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),t.opacity=this.__.opacity,this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const s=t.getSameCanvas(!0,!0);this.__draw(s,e),this.__worldFlipped?t.copyWorldByReset(s,this.__nowWorld,null,this.__.__blendMode,!0):t.copyWorldToInner(s,this.__nowWorld,this.__layout.renderBounds,this.__.__blendMode),s.recycle(this.__nowWorld)}else this.__draw(t,e)},__clip(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawRenderPath(t),this.windingRule?t.clip(this.windingRule):t.clip())},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:on}=eo,nn={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){if(this.__worldOpacity)if(this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const s=t.getSameCanvas(!1,!0);this.__renderBranch(s,e);const i=this.__getNowWorld(e);t.opacity=this.__.opacity,t.copyWorldByReset(s,i,i,this.__.__blendMode,!0),s.recycle(i)}else this.__renderBranch(t,e)},__renderBranch(t,e){if(this.__hasMask)this.__renderMask(t,e);else{const{children:s}=this;for(let i=0,r=s.length;i<r;i++)on(s[i],e)||s[i].__render(t,e)}},__clip(t,e){if(this.__worldOpacity){const{children:s}=this;for(let i=0,r=s.length;i<r;i++)on(s[i],e)||s[i].__clip(t,e)}}},{LEAF:an,create:hn}=a,{toInnerPoint:ln,toOuterPoint:dn,multiplyParent:_n}=k,{toOuterOf:un}=ot,{copy:cn,move:pn}=M,{moveLocal:gn,zoomOfLocal:yn,rotateOfLocal:fn,skewOfLocal:mn,moveWorld:xn,zoomOfWorld:wn,rotateOfWorld:vn,skewOfWorld:bn,transform:Bn,transformWorld:kn,setTransform:On,getFlipTransform:Cn,getLocalOrigin:Rn,getRelativeWorld:Tn,drop:Pn}=Ur;let Sn=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return Lt}get __LayoutProcessor(){return fo}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.update(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){const{leafer:t}=this;return t&&t.created&&t.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){this.on(t)}constructor(t){this.innerId=hn(an),this.reset(t),this.__bubbleMap&&this.__emitLifeEvent(xo.CREATED)}reset(t){this.leafer&&this.leafer.forceRender(this.__world),this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},null!==t&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0}),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.on(xo.ADD,t,"once")}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.on(xo.MOUNTED,t,"once")}nextRender(t,e,s){this.leafer?this.leafer.nextRender(t,e,s):this.waitLeafer((()=>this.leafer.nextRender(t,e,s)))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t?(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(xo.MOUNTED)):this.__emitLifeEvent(xo.UNMOUNTED),this.isBranch){const{children:e}=this;for(let s=0,i=e.length;s<i;s++)e[s].__bindLeafer(t)}}set(t,e){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(t){void 0===t?t="width":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=void 0===e?null:void 0,this[t]=e}forceRender(t){this.forceUpdate("surface")}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateContentBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=!!t||this.children.some((t=>t.__.eraser))}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:s}=this.__layout;t.clearRect(s.x,s.y,s.width,s.height),t.restore()}__updateMask(t){this.__hasMask=!!t||this.children.some((t=>t.__.mask))}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld;return _n(this.__world,t.matrix,e,void 0,this.__world),un(this.__layout.renderBounds,e,e),e}return this.__world}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,s){return this.__layout.getLayoutBounds(t,e,s)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,s){const i=e?Tn(this,e):this.worldTransform,r=s?t:{};return un(t,i,r),r}worldToLocal(t,e,s,i){this.parent?this.parent.worldToInner(t,e,s,i):e&&cn(e,t)}localToWorld(t,e,s,i){this.parent?this.parent.innerToWorld(t,e,s,i):e&&cn(e,t)}worldToInner(t,e,s,i){i&&(i.innerToWorld(t,e,s),t=e||t),ln(this.worldTransform,t,e,s)}innerToWorld(t,e,s,i){dn(this.worldTransform,t,e,s),i&&i.worldToInner(e||t,null,s)}getBoxPoint(t,e,s,i){return this.getBoxPointByInner(this.getInnerPoint(t,e,s,i),null,null,!0)}getBoxPointByInner(t,e,s,i){const r=i?t:Object.assign({},t),{x:o,y:n}=this.boxBounds;return pn(r,-o,-n),r}getInnerPoint(t,e,s,i){const r=i?t:{};return this.worldToInner(t,r,s,e),r}getInnerPointByBox(t,e,s,i){const r=i?t:Object.assign({},t),{x:o,y:n}=this.boxBounds;return pn(r,o,n),r}getInnerPointByLocal(t,e,s,i){return this.getInnerPoint(t,this.parent,s,i)}getLocalPoint(t,e,s,i){const r=i?t:{};return this.worldToLocal(t,r,s,e),r}getLocalPointByInner(t,e,s,i){return this.getWorldPoint(t,this.parent,s,i)}getPagePoint(t,e,s,i){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,s,i)}getWorldPoint(t,e,s,i){const r=i?t:{};return this.innerToWorld(t,r,s,e),r}getWorldPointByBox(t,e,s,i){return this.getWorldPoint(this.getInnerPointByBox(t,null,null,i),e,s,!0)}getWorldPointByLocal(t,e,s,i){const r=i?t:{};return this.localToWorld(t,r,s,e),r}getWorldPointByPage(t,e,s,i){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,s,i)}setTransform(t,e){On(this,t,e)}transform(t,e){Bn(this,t,e)}move(t,e){gn(this,t,e)}moveInner(t,e){xn(this,t,e,!0)}scaleOf(t,e,s,i){yn(this,Rn(this,t),e,s,i)}rotateOf(t,e){fn(this,Rn(this,t),e)}skewOf(t,e,s,i){mn(this,Rn(this,t),e,s,i)}transformWorld(t,e){kn(this,t,e)}moveWorld(t,e){xn(this,t,e)}scaleOfWorld(t,e,s,i){wn(this,t,e,s,i)}rotateOfWorld(t,e){vn(this,t,e)}skewOfWorld(t,e,s,i){bn(this,t,e,s,i)}flip(t){Bn(this,Cn(this,t))}scaleResize(t,e=t,s){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}__hitWorld(t){return!0}__hit(t){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e){}__clip(t,e){}__renderShape(t,e,s,i){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return Bt("path")}getMotionPoint(t){return Bt("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(t,e){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,s){Pn(this,t,e,s)}on(t,e,s){}off(t,e,s){}on_(t,e,s,i){}off_(t){}once(t,e,s){}emit(t,e,s){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,s){s?this.addAttr(t,e,s):Tr(this.prototype,t,e)}static addAttr(t,e,s){s||(s=fr),s(e)(this.prototype,t)}__emitLifeEvent(t){this.hasEvent(t)&&this.emitEvent(new xo(t,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(xo.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}};Sn=Mt([Mr(Xo),Mr(qo),Mr(sn),Mr(No),Mr(rn)],Sn);const{setListWithFn:En}=ot,{sort:An}=io,{localBoxBounds:Ln,localStrokeBounds:In,localRenderBounds:Mn,maskLocalBoxBounds:Wn,maskLocalStrokeBounds:Dn,maskLocalRenderBounds:Nn}=eo;let Fn=class extends Sn{__updateStrokeSpread(){const{children:t}=this;for(let e=0,s=t.length;e<s;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,s=t.length;e<s;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){En(this.__layout.boxBounds,this.children,this.__hasMask?Wn:Ln)}__updateStrokeBounds(){En(this.__layout.strokeBounds,this.children,this.__hasMask?Dn:In)}__updateRenderBounds(){En(this.__layout.renderBounds,this.children,this.__hasMask?Nn:Mn)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let s=0,i=e.length;s<i;s++)e[s].__tempNumber=s,e[s].__.zIndex&&(t=!0);e.sort(An),this.__layout.affectChildrenSort=t}}add(t,e){if(t===this)return;const s=void 0===e;if(!t.__){if(t instanceof Array)return t.forEach((t=>{this.add(t,e),s||e++}));t=Ot.get(t.tag,t)}t.parent&&t.parent.remove(t),t.parent=this,s?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),t.__layout.boxChanged||t.__layout.boxChange(),t.__layout.matrixChanged||t.__layout.matrixChange(),t.__bubbleMap&&t.__emitLifeEvent(xo.ADD),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(xo.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){this.add(t)}remove(t,e){t?t.__?t.animationOut?t.__runAnimation("out",(()=>this.__remove(t,e))):this.__remove(t,e):this.find(t).forEach((t=>this.remove(t,e))):void 0===t&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach((e=>{this.__realRemoveChild(e),t&&e.destroy()})))}clear(){this.removeAll(!0)}__remove(t,e){const s=this.children.indexOf(t);s>-1&&(this.children.splice(s,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.__emitLifeEvent(xo.REMOVE),t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(xo.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const s=new xo(t,e,this);this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(s),this.leafer.emitEvent(s)}};Fn=Mt([Mr(nn)],Fn);class Yn{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return t&&void 0!==this.keys[t.innerId]}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return void 0===e?-1:e}add(t){const{list:e,keys:s}=this;void 0===s[t.innerId]&&(e.push(t),s[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:s}=this;if(void 0===s[t.innerId]){const{list:i}=this;for(let t=e,r=i.length;t<r;t++)s[i[t].innerId]++;0===e?i.unshift(t):(e>i.length&&(e=i.length),i.splice(e,0,t)),s[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let s;for(let i=0,r=e.length;i<r;i++)void 0!==s?this.keys[e[i].innerId]=i-1:e[i].innerId===t.innerId&&(s=i,delete this.keys[t.innerId]);void 0!==s&&e.splice(s,1)}sort(t){const{list:e}=this;t?e.sort(((t,e)=>e.__level-t.__level)):e.sort(((t,e)=>t.__level-e.__level))}forEach(t){this.list.forEach(t)}clone(){const t=new Yn;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let s=0,i=t.length;s<i;s++)e[t[s].innerId]=s}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}function Xn(t,e,s,i){var r,o=arguments.length,n=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(o<3?r(n):o>3?r(e,s,n):r(e,s))||n);return o>3&&n&&Object.defineProperty(e,s,n),n}function zn(t){return _r(t,(t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}})))}function Gn(t){return _r(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}})))}"function"==typeof SuppressedError&&SuppressedError;const jn={},Hn={number:(t,e)=>"object"==typeof t?"percent"===t.type?t.value*e:t.value:t},Vn={},Un={},qn={},Jn={},Qn={},{parse:Zn,objectToCanvasData:$n}=ds,Kn={},ta=ft.get("UIData");class ea extends Lt{get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get __strokeWidth(){const{strokeWidth:t,strokeWidthFixed:e}=this;if(e){const e=this.__leaf;let{scaleX:s}=e.__nowWorld||e.__world;return s<0&&(s=-s),s>1?t/s:t}return t}get __hasStroke(){return this.stroke&&this.strokeWidth}get __clipAfterFill(){return this.cornerRadius||this.__pathInputed}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:e}=this.__leaf;e&&(e.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,ta.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,ta.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isFills=!0,this._fill||(this._fill=Kn)):(this.__isFills&&(this.__removeInput("fill"),qn.recycleImage("fill",this),this.__isFills=!1,this.__pixelFill&&(this.__pixelFill=!1)),this._fill=t)}setStroke(t){"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isStrokes=!0,this._stroke||(this._stroke=Kn)):(this.__isStrokes&&(this.__removeInput("stroke"),qn.recycleImage("stroke",this),this.__isStrokes=!1,this.__pixelStroke&&(this.__pixelStroke=!1)),this._stroke=t)}setPath(t){const e="string"==typeof t;e||t&&"object"==typeof t[0]?(this.__setInput("path",t),this._path=e?Zn(t):$n(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._shadow=t.length?t:null):this._shadow=t&&!1!==t.visible?[t]:null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._innerShadow=t.length?t:null):this._innerShadow=t&&!1!==t.visible?[t]:null}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&Un.compute("fill",this.__leaf),e&&Un.compute("stroke",this.__leaf),this.__needComputePaint=!1}}class sa extends ea{}class ia extends sa{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return"hide"===this.overflow&&this.__clipAfterFill&&this.__leaf.children.length}get __clipAfterFill(){return this.__leaf.isOverflow||super.__clipAfterFill}}class ra extends ea{}class oa extends ea{get __boxStroke(){return!this.__pathInputed}}const na={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};const aa={__updateStrokeSpread(){let t=0,e=0;const s=this.__,{strokeAlign:i,strokeWidth:r}=s;if((s.stroke||"all"===s.hitStroke)&&r&&"inside"!==i&&(e=t="center"===i?r/2:r,!s.__boxStroke)){const e=s.__isLinePath?0:10*t,i="none"===s.strokeCap?0:r;t+=Math.max(e,i)}return s.__useArrow&&(t+=5*r),this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:s,blur:i,backgroundBlur:r}=this.__;e&&e.forEach((e=>t=Math.max(t,Math.max(Math.abs(e.y),Math.abs(e.x))+(e.spread>0?e.spread:0)+1.5*e.blur))),i&&(t=Math.max(t,i));let o=t=Math.ceil(t);return s&&s.forEach((t=>o=Math.max(o,Math.max(Math.abs(t.y),Math.abs(t.x))+(t.spread<0?-t.spread:0)+1.5*t.blur))),r&&(o=Math.max(o,r)),this.__layout.renderShapeSpread=o,t+(this.__layout.strokeSpread||0)}},ha={__updateChange(){const t=this.__;if(t.__useEffect){const{shadow:e,innerShadow:s,blur:i,backgroundBlur:r}=this.__;t.__useEffect=!!(e||s||i||r)}t.__checkSingle();t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect?t.__complex=!0:t.__complex&&(t.__complex=!1)},__drawFast(t,e){la(this,t,e)},__draw(t,e){const s=this.__;if(s.__complex){s.__needComputePaint&&s.__computePaint();const{fill:i,stroke:r,__drawAfterFill:o}=s;if(this.__drawRenderPath(t),s.__useEffect){const n=Un.shape(this,t,e);this.__nowWorld=this.__getNowWorld(e);const{shadow:a,innerShadow:h}=s;a&&Jn.shadow(this,t,n),i&&(s.__isFills?Un.fills(i,this,t):Un.fill(i,this,t)),o&&this.__drawAfterFill(t,e),h&&Jn.innerShadow(this,t,n),r&&(s.__isStrokes?Un.strokes(r,this,t):Un.stroke(r,this,t)),n.worldCanvas&&n.worldCanvas.recycle(),n.canvas.recycle()}else i&&(s.__isFills?Un.fills(i,this,t):Un.fill(i,this,t)),o&&this.__drawAfterFill(t,e),r&&(s.__isStrokes?Un.strokes(r,this,t):Un.stroke(r,this,t))}else s.__pathInputed?la(this,t,e):this.__drawFast(t,e)},__renderShape(t,e,s,i){if(this.__worldOpacity){t.setWorld(this.__nowWorld=this.__getNowWorld(e));const{fill:r,stroke:o}=this.__;this.__drawRenderPath(t),r&&!s&&(this.__.__pixelFill?Un.fills(r,this,t):Un.fill("#000000",this,t)),this.__.__isCanvas&&this.__drawAfterFill(t,e),o&&!i&&(this.__.__pixelStroke?Un.strokes(o,this,t):Un.stroke("#000000",this,t))}},__drawAfterFill(t,e){this.__.__clipAfterFill?(t.save(),this.windingRule?t.clip(this.windingRule):t.clip(),this.__drawContent(t,e),t.restore()):this.__drawContent(t,e)}};function la(t,e,s){const{fill:i,stroke:r,__drawAfterFill:o}=t.__;t.__drawRenderPath(e),i&&Un.fill(i,t,e),o&&t.__drawAfterFill(e,s),r&&Un.stroke(r,t,e)}const da={__drawFast(t,e){let{width:s,height:i,fill:r,stroke:o,__drawAfterFill:n}=this.__;if(r&&(t.fillStyle=r,t.fillRect(0,0,s,i)),n&&this.__drawAfterFill(t,e),o){const{strokeAlign:r,__strokeWidth:n}=this.__;if(!n)return;t.setStroke(o,n,this.__);const a=n/2;switch(r){case"center":t.strokeRect(0,0,s,i);break;case"inside":s-=n,i-=n,s<0||i<0?(t.save(),this.__clip(t,e),t.strokeRect(a,a,s,i),t.restore()):t.strokeRect(a,a,s,i);break;case"outside":t.strokeRect(-a,-a,s+n,i+n)}}}};var _a;let ua=_a=class extends Sn{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){u.assignScale(this,t)}get scale(){return this.__.scale}get pen(){const{path:t}=this.__;return $i.set(this.path=t||[]),t||this.__drawPathByBox($i),$i}get editConfig(){}get editOuter(){return""}get editInner(){return""}constructor(t){super(t)}reset(t){}set(t,e){e?(this.lockNormalStyle=!0,Object.assign(this,t),this.lockNormalStyle=!1):Object.assign(this,t)}get(t){return"string"==typeof t?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){}findTag(t){return this.find({tag:t})}findOne(t,e){}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let s=e?this.__.__pathForRender:this.__.path;return s||($i.set(s=[]),this.__drawPathByBox($i)),t?ds.toCanvasData(s,!0):s}getPathString(t,e,s){return ds.stringify(this.getPath(t,e),s)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;!t.lazy||this.__inLazyBounds||Qn.running?t.__computePaint():t.__needComputePaint=!0}}__updateRenderPath(){if(this.__.path){const t=this.__;t.__pathForRender=t.cornerRadius?Zi.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&Vn.addArrows(this,!t.cornerRadius)}}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){e?_i.drawPathByData(t,e):this.__drawPathByBox(t)}__drawPathByBox(t){const{x:e,y:s,width:i,height:r}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:o}=this.__;t.roundRect(e,s,i,r,"number"==typeof o?[o]:o)}else t.rect(e,s,i,r)}animate(t,e,s,i){return Bt("animate")}killAnimate(t){}export(t,e){return Qn.export(this,t,e)}clone(t){const e=this.toJSON();return t&&Object.assign(e,t),_a.one(e)}static one(t,e,s,i,r){return Ot.get(t.tag||this.prototype.__tag,t,e,s,i,r)}static registerUI(){Wr()(this)}static registerData(t){Rr(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};var ca;Xn([Rr(ea)],ua.prototype,"__",void 0),Xn([(t,e)=>{const s="_"+e;lr(t,e,{set(t){this.isLeafer&&(this[s]=t)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[s]||this:this.leafer&&this.leafer.zoomLayer}})}],ua.prototype,"zoomLayer",void 0),Xn([ur("")],ua.prototype,"id",void 0),Xn([ur("")],ua.prototype,"name",void 0),Xn([ur("")],ua.prototype,"className",void 0),Xn([kr("pass-through")],ua.prototype,"blendMode",void 0),Xn([(ca=1,_r(ca,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange())}}))))],ua.prototype,"opacity",void 0),Xn([function(t){return _r(t,(t=>({set(e){const s=this.visible;if(!0===s&&0===e){if(this.animationOut)return this.__runAnimation("out",(()=>Or(this,t,e,s)))}else 0===s&&!0===e&&this.animation&&this.__runAnimation("in");Or(this,t,e,s)}})))}(!0)],ua.prototype,"visible",void 0),Xn([kr(!1)],ua.prototype,"locked",void 0),Xn([function(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.waitParent((()=>{this.parent.__layout.childrenSortChange()})))}})))}(0)],ua.prototype,"zIndex",void 0),Xn([function(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent((()=>{this.parent.__updateMask(e)})))}})))}(!1)],ua.prototype,"mask",void 0),Xn([function(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&this.waitParent((()=>{this.parent.__updateEraser(e)}))}})))}(!1)],ua.prototype,"eraser",void 0),Xn([cr(0,!0)],ua.prototype,"x",void 0),Xn([cr(0,!0)],ua.prototype,"y",void 0),Xn([fr(100,!0)],ua.prototype,"width",void 0),Xn([fr(100,!0)],ua.prototype,"height",void 0),Xn([gr(1,!0)],ua.prototype,"scaleX",void 0),Xn([gr(1,!0)],ua.prototype,"scaleY",void 0),Xn([yr(0,!0)],ua.prototype,"rotation",void 0),Xn([yr(0,!0)],ua.prototype,"skewX",void 0),Xn([yr(0,!0)],ua.prototype,"skewY",void 0),Xn([cr(0,!0)],ua.prototype,"offsetX",void 0),Xn([cr(0,!0)],ua.prototype,"offsetY",void 0),Xn([cr(0,!0)],ua.prototype,"scrollX",void 0),Xn([cr(0,!0)],ua.prototype,"scrollY",void 0),Xn([pr()],ua.prototype,"origin",void 0),Xn([pr()],ua.prototype,"around",void 0),Xn([ur(!1)],ua.prototype,"lazy",void 0),Xn([function(t){return _r(t,(t=>({set(e){this.__setAttr(t,e)&&(mr(this),this.__.__removeNaturalSize())}})))}(1)],ua.prototype,"pixelRatio",void 0),Xn([function(t){return _r(t,(t=>({set(e){const s=this.__;2!==s.__pathInputed&&(s.__pathInputed=e?1:0),e||(s.__pathForRender=void 0),this.__setAttr(t,e),mr(this)}})))}()],ua.prototype,"path",void 0),Xn([xr()],ua.prototype,"windingRule",void 0),Xn([xr(!0)],ua.prototype,"closed",void 0),Xn([fr(0)],ua.prototype,"padding",void 0),Xn([ur(!1)],ua.prototype,"draggable",void 0),Xn([ur()],ua.prototype,"dragBounds",void 0),Xn([ur(!1)],ua.prototype,"editable",void 0),Xn([Cr(!0)],ua.prototype,"hittable",void 0),Xn([Cr("path")],ua.prototype,"hitFill",void 0),Xn([br("path")],ua.prototype,"hitStroke",void 0),Xn([Cr(!1)],ua.prototype,"hitBox",void 0),Xn([Cr(!0)],ua.prototype,"hitChildren",void 0),Xn([Cr(!0)],ua.prototype,"hitSelf",void 0),Xn([Cr()],ua.prototype,"hitRadius",void 0),Xn([function(t){return _r(t,(t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}})))}("")],ua.prototype,"cursor",void 0),Xn([kr()],ua.prototype,"fill",void 0),Xn([br()],ua.prototype,"stroke",void 0),Xn([br("inside")],ua.prototype,"strokeAlign",void 0),Xn([br(1)],ua.prototype,"strokeWidth",void 0),Xn([br(!1)],ua.prototype,"strokeWidthFixed",void 0),Xn([br("none")],ua.prototype,"strokeCap",void 0),Xn([br("miter")],ua.prototype,"strokeJoin",void 0),Xn([br()],ua.prototype,"dashPattern",void 0),Xn([br()],ua.prototype,"dashOffset",void 0),Xn([br(10)],ua.prototype,"miterLimit",void 0),Xn([xr(0)],ua.prototype,"cornerRadius",void 0),Xn([xr()],ua.prototype,"cornerSmoothing",void 0),Xn([zn()],ua.prototype,"shadow",void 0),Xn([zn()],ua.prototype,"innerShadow",void 0),Xn([zn()],ua.prototype,"blur",void 0),Xn([zn()],ua.prototype,"backgroundBlur",void 0),Xn([zn()],ua.prototype,"grayscale",void 0),Xn([ur({})],ua.prototype,"data",void 0),Xn([Ar(Sn.prototype.reset)],ua.prototype,"reset",null),ua=_a=Xn([Mr(aa),Mr(ha),Lr()],ua);let pa=class extends ua{get __tag(){return"Group"}get isBranch(){return!0}constructor(t){super(t)}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,e){if(t.children){const{children:s}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,e),s.forEach((t=>this.add(t))),t.children=s}else super.set(t,e)}toJSON(t){const e=super.toJSON(t);return e.children=this.children.map((e=>e.toJSON(t))),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}};var ga;Xn([Rr(sa)],pa.prototype,"__",void 0),pa=Xn([Mr(Fn),Wr()],pa);const ya=ft.get("Leafer");let fa=ga=class extends pa{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&rr.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds()}constructor(t,e){super(e),this.config={type:"design",start:!0,hittable:!0,smooth:!0,lazySpeard:100,zoom:{min:.01,max:256},move:{holdSpaceKey:!0,holdMiddleKey:!0,autoDistance:2}},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),ga.list.add(this)}init(t,e){if(this.canvas)return;let s;this.__setLeafer(this),t&&Et.assign(this.config,t);const{config:i}=this;this.initType(i.type);const r=this.canvas=n.canvas(i);this.__controllers.push(this.renderer=n.renderer(this,r,i),this.watcher=n.watcher(this,i),this.layouter=n.layouter(this,i)),this.isApp&&this.__setApp(),this.__checkAutoLayout(i,e),this.view=r.view,e?(this.__bindApp(e),s=e.running):(this.selector=n.selector(this),this.interaction=n.interaction(this,r,this.selector,i),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=n.hitCanvasManager()),this.canvasManager=new St,s=i.start),this.hittable=i.hittable,this.fill=i.fill,this.canvasManager.add(r),this.__listenEvents(),s&&(this.__startTimer=setTimeout(this.start.bind(this))),ao.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t){this.waitInit((()=>{super.set(t)}))}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(Co.RESTART):this.emitLeafer(Co.START),this.__controllers.forEach((t=>t.start())),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach((t=>t.stop())),this.running=!1,this.emitLeafer(Co.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=Et.copyAttrs({},t,zt);Object.keys(e).forEach((t=>this[t]=e[t]))}forceRender(t){this.renderer.addBlock(t?new lt(t):this.canvas.bounds),this.viewReady&&this.renderer.update()}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const s=Et.copyAttrs({},this.canvas,zt);e.resize(t),this.updateLazyBounds(),this.__onResize(new bo(t,s))}__onResize(t){this.emitEvent(t),Et.copyAttrs(this.__,t,zt),t.width&&t.height||ya.warn("w = 0 or h = 0"),setTimeout((()=>{this.canvasManager&&this.canvasManager.clearRecycled()}),0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(t,e){e||(t.width&&t.height||(this.autoLayout=new dt(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(zt.includes(t)?(e||ya.warn(t+" is 0"),this.__changeCanvasSize(t,e)):"fill"===t?this.__changeFill(e):"hittable"===t?this.parent||(this.canvas.hittable=e):"zIndex"===t&&(this.canvas.zIndex=e,setTimeout((()=>this.parent&&this.parent.__updateSortChildren())))),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&zt.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const s=Et.copyAttrs({},this.canvas,zt);s[t]=this.config[t]=e,e&&this.canvas.stopAutoLayout(),this.__doResize(s)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(Co.BEFORE_READY),this.emitLeafer(Co.READY),this.emitLeafer(Co.AFTER_READY),ao.run(this.__readyWait))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(Co.VIEW_READY),ao.run(this.__viewReadyWait))}__onNextRender(){if(this.viewReady){ao.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1)}}__checkViewCompleted(t=!0){this.nextRender((()=>{this.imageReady&&(t&&this.emitLeafer(Co.VIEW_COMPLETED),ao.run(this.__viewCompletedWait),this.viewCompleted=!0)}))}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender((()=>this.interaction.updateCursor()))}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,s){e&&(t=t.bind(e));const i=this.__nextRenderWait;if(s){for(let e=0;e<i.length;e++)if(i[e]===t){i.splice(e,1);break}}else i.push(t)}zoom(t,e,s){return Bt("view")}getValidMove(t,e){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}__checkUpdateLayout(){this.__layout.update()}emitLeafer(t){this.emitEvent(new Co(t,this))}__listenEvents(){const t=vt.start("FirstCreate "+this.innerName);this.once(Co.START,(()=>vt.end(t))),this.once(ko.START,(()=>this.updateLazyBounds())),this.once(ko.END,(()=>this.__onReady())),this.once(Oo.START,(()=>this.__onCreated())),this.once(Oo.END,(()=>this.__onViewReady())),this.__eventIds.push(this.on_(Bo.DATA,this.__onWatchData,this),this.on_(Oo.NEXT,this.__onNextRender,this),this.on_(ko.CHECK_UPDATE,this.__checkUpdateLayout,this))}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(t){const e=()=>{if(!this.destroyed){ga.list.remove(this);try{this.stop(),this.emitEvent(new Co(Co.END,this)),this.__removeListenEvents(),this.__controllers.forEach((t=>!(this.parent&&t===this.interaction)&&t.destroy())),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager.destroy()),this.canvas.destroy(),this.config.view=this.view=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout((()=>{rr.clearRecycled()}),100)}catch(t){ya.error(t)}}};t?e():setTimeout(e)}};fa.list=new Yn,Xn([Rr(class extends sa{__getInputData(t,e){const s=super.__getInputData(t,e);return zt.forEach((t=>delete s[t])),s}})],fa.prototype,"__",void 0),Xn([fr()],fa.prototype,"pixelRatio",void 0),fa=ga=Xn([Wr()],fa);let ma=class extends ua{get __tag(){return"Rect"}constructor(t){super(t)}};Xn([Rr(oa)],ma.prototype,"__",void 0),ma=Xn([Mr(da),Lr(),Wr()],ma);const{copy:xa,add:wa,includes:va}=ot,ba=ma.prototype,Ba=pa.prototype,ka={};let Oa=class extends pa{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){const e=this.__;if(this.children.length)if(e.__autoSide){super.__updateBoxBounds();const{boxBounds:t}=this.__layout;e.__autoSize||(e.__autoWidth?(t.width+=t.x,t.x=0,t.height=e.height,t.y=0):(t.height+=t.y,t.y=0,t.width=e.width,t.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds();else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t;const{renderBounds:e}=this.__layout;this.children.length?(super.__updateRenderBounds(),xa(ka,e),this.__updateRectRenderBounds(),t=!va(e,ka),t&&"hide"!==this.__.overflow&&wa(e,ka)):this.__updateRectRenderBounds(),!this.isOverflow!=!t&&(this.isOverflow=t)}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e))}__drawContent(t,e){this.__renderGroup(t,e),this.__.__hasStroke&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}};Xn([Rr(ia)],Oa.prototype,"__",void 0),Xn([ur(!1)],Oa.prototype,"resizeChildren",void 0),Xn([ur(!1)],Oa.prototype,"textBox",void 0),Xn([Br("show")],Oa.prototype,"overflow",void 0),Xn([Ar(ba.__updateStrokeSpread)],Oa.prototype,"__updateStrokeSpread",null),Xn([Ar(ba.__updateRenderSpread)],Oa.prototype,"__updateRectRenderSpread",null),Xn([Ar(ba.__updateBoxBounds)],Oa.prototype,"__updateRectBoxBounds",null),Xn([Ar(ba.__updateStrokeBounds)],Oa.prototype,"__updateStrokeBounds",null),Xn([Ar(ba.__updateRenderBounds)],Oa.prototype,"__updateRectRenderBounds",null),Xn([Ar(ba.__updateChange)],Oa.prototype,"__updateRectChange",null),Xn([Ar(ba.__render)],Oa.prototype,"__renderRect",null),Xn([Ar(Ba.__render)],Oa.prototype,"__renderGroup",null),Oa=Xn([Lr(),Wr()],Oa);let Ca=class extends Oa{get __tag(){return"Frame"}get isFrame(){return!0}constructor(t){super(t)}};Xn([Rr(class extends ia{})],Ca.prototype,"__",void 0),Xn([kr("#FFFFFF")],Ca.prototype,"fill",void 0),Xn([Br("hide")],Ca.prototype,"overflow",void 0),Ca=Xn([Wr()],Ca);const{moveTo:Ra,closePath:Ta,ellipse:Pa}=Ls;let Sa=class extends ua{get __tag(){return"Ellipse"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,innerRadius:s,startAngle:i,endAngle:r}=this.__,n=t/2,a=e/2,h=this.__.path=[];s?(i||r?(s<1&&Pa(h,n,a,n*s,a*s,0,i,r,!1),Pa(h,n,a,n,a,0,r,i,!0),s<1&&Ta(h)):(s<1&&(Pa(h,n,a,n*s,a*s),Ra(h,t,a)),Pa(h,n,a,n,a,0,360,0,!0)),o.ellipseToCurve&&(this.__.path=this.getPath(!0))):i||r?(Ra(h,n,a),Pa(h,n,a,n,a,0,i,r,!1),Ta(h)):Pa(h,n,a,n,a)}};Xn([Rr(class extends ea{get __boxStroke(){return!this.__pathInputed}})],Sa.prototype,"__",void 0),Xn([xr(0)],Sa.prototype,"innerRadius",void 0),Xn([xr(0)],Sa.prototype,"startAngle",void 0),Xn([xr(0)],Sa.prototype,"endAngle",void 0),Sa=Xn([Wr()],Sa);const{moveTo:Ea,lineTo:Aa,drawPoints:La}=Ls,{rotate:Ia,getAngle:Ma,getDistance:Wa,defaultPoint:Da}=M,{toBounds:Na}=Gi;let Fa=class extends ua{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,s={x:0,y:0};return t&&(s.x=t),e&&Ia(s,e),s}set toPoint(t){this.width=Wa(Da,t),this.rotation=Ma(Da,t),this.height&&(this.height=0)}constructor(t){super(t)}__updatePath(){const t=this.__,e=t.path=[];t.points?La(e,t.points,!1,t.closed):(Ea(e,0,0),Aa(e,this.width,0))}__updateRenderPath(){const t=this.__;!this.pathInputed&&t.points&&t.curve?(La(t.__pathForRender=[],t.points,t.curve,t.closed),t.__useArrow&&Vn.addArrows(this,!1)):super.__updateRenderPath()}__updateBoxBounds(){this.points?Na(this.__.__pathForRender,this.__layout.boxBounds):super.__updateBoxBounds()}};Xn([Rr(ra)],Fa.prototype,"__",void 0),Xn([wr("center")],Fa.prototype,"strokeAlign",void 0),Xn([fr(0)],Fa.prototype,"height",void 0),Xn([xr()],Fa.prototype,"points",void 0),Xn([xr(0)],Fa.prototype,"curve",void 0),Xn([xr(!1)],Fa.prototype,"closed",void 0),Fa=Xn([Wr()],Fa);const{sin:Ya,cos:Xa,PI:za}=Math,{moveTo:Ga,lineTo:ja,closePath:Ha,drawPoints:Va}=Ls,Ua=Fa.prototype;let qa=class extends ua{get __tag(){return"Polygon"}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];if(this.__.points)Va(t,this.__.points,!1,!0);else{const{width:e,height:s,sides:i}=this.__,r=e/2,o=s/2;Ga(t,r,0);for(let e=1;e<i;e++)ja(t,r+r*Ya(2*e*za/i),o-o*Xa(2*e*za/i))}Ha(t)}__updateRenderPath(){}__updateBoxBounds(){}};Xn([Rr(class extends ea{})],qa.prototype,"__",void 0),Xn([xr(3)],qa.prototype,"sides",void 0),Xn([xr()],qa.prototype,"points",void 0),Xn([xr(0)],qa.prototype,"curve",void 0),Xn([Ar(Ua.__updateRenderPath)],qa.prototype,"__updateRenderPath",null),Xn([Ar(Ua.__updateBoxBounds)],qa.prototype,"__updateBoxBounds",null),qa=Xn([Lr(),Wr()],qa);const{sin:Ja,cos:Qa,PI:Za}=Math,{moveTo:$a,lineTo:Ka,closePath:th}=Ls;let eh=class extends ua{get __tag(){return"Star"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,corners:s,innerRadius:i}=this.__,r=t/2,o=e/2,n=this.__.path=[];$a(n,r,0);for(let t=1;t<2*s;t++)Ka(n,r+(t%2==0?r:r*i)*Ja(t*Za/s),o-(t%2==0?o:o*i)*Qa(t*Za/s));th(n)}};Xn([Rr(class extends ea{})],eh.prototype,"__",void 0),Xn([xr(5)],eh.prototype,"corners",void 0),Xn([xr(.382)],eh.prototype,"innerRadius",void 0),eh=Xn([Wr()],eh);let sh=class extends ma{get __tag(){return"Image"}get ready(){return!!this.image&&this.image.ready}constructor(t){super(t),this.on(vo.LOADED,(t=>{"fill"===t.attrName&&t.attrValue.url===this.url&&(this.image=t.image)}))}destroy(){this.image=null,super.destroy()}};Xn([Rr(class extends oa{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.__leaf.image&&(this.__leaf.image=null),this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return delete t.fill,t}__getInputData(t,e){const s=super.__getInputData(t,e);return delete s.fill,s}})],sh.prototype,"__",void 0),Xn([fr("")],sh.prototype,"url",void 0),sh=Xn([Wr()],sh);let ih=class extends ma{get __tag(){return"Canvas"}get ready(){return!this.url}constructor(t){super(t),this.canvas=n.canvas(this.__),this.context=this.canvas.context,t&&t.url&&this.drawImage(t.url)}drawImage(t){new hr({url:t}).load((t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new vo(vo.LOADED,{image:t}))}))}draw(t,e,s,i){const r=new X(t.worldTransform).invert(),o=new X;e&&o.translate(e.x,e.y),s&&("number"==typeof s?o.scale(s):o.scale(s.x,s.y)),i&&o.rotate(i),r.multiplyParent(o),t.__render(this.canvas,{matrix:r.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,e){const{width:s,height:i}=this.__,{view:r}=this.canvas;t.drawImage(r,0,0,r.width,r.height,0,0,s,i)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e}=this.__;t.smooth!==e&&(t.smooth=e),t.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=this.context=null),super.destroy()}};Xn([Rr(class extends oa{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,e){const s=super.__getInputData(t,e);return s.url=this.__leaf.canvas.toDataURL("image/png"),s}})],ih.prototype,"__",void 0),Xn([Gn(100)],ih.prototype,"width",void 0),Xn([Gn(100)],ih.prototype,"height",void 0),Xn([Gn(1)],ih.prototype,"pixelRatio",void 0),Xn([Gn(!0)],ih.prototype,"smooth",void 0),Xn([Gn()],ih.prototype,"contextSettings",void 0),ih=Xn([Wr()],ih);const{copyAndSpread:rh,includes:oh,isSame:nh,spread:ah,setList:hh}=ot;let lh=class extends ua{get __tag(){return"Text"}get textDrawData(){return this.__layout.update(),this.__.__textDrawData}constructor(t){super(t)}__drawHitPath(t){const{__lineHeight:e,fontSize:s,__baseLine:i,__textDrawData:r}=this.__;t.beginPath(),this.__.__letterSpacing<0?this.__drawPathByData(t):r.rows.forEach((r=>t.rect(r.x,r.y-i,r.width,e<s?s:e)))}__drawPathByData(t,e){const{x:s,y:i,width:r,height:o}=this.__layout.boxBounds;t.rect(s,i,r,o)}__drawRenderPath(t){t.font=this.__.__font}__updateTextDrawData(){const t=this.__,{lineHeight:e,letterSpacing:s,fontFamily:i,fontSize:r,fontWeight:o,italic:n,textCase:a,textOverflow:h,padding:l}=t;t.__lineHeight=Hn.number(e,r),t.__letterSpacing=Hn.number(s,r),t.__padding=l?u.fourNumber(l):void 0,t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*r)/2,t.__font=`${n?"italic ":""}${"small-caps"===a?"small-caps ":""}${"normal"!==o?o+" ":""}${r}px ${i}`,t.__clipText="show"!==h&&!t.__autoSize,t.__textDrawData=jn.getDrawData(t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{fontSize:s,italic:i,padding:r,__autoWidth:o,__autoHeight:n}=t;this.__updateTextDrawData();const{bounds:a}=t.__textDrawData,h=e.boxBounds;if(t.__lineHeight<s&&ah(a,s/2),o||n){if(h.x=o?a.x:0,h.y=n?a.y:0,h.width=o?a.width:t.width,h.height=n?a.height:t.height,r){const[e,s,i,r]=t.__padding;o&&(h.x-=r,h.width+=s+r),n&&(h.y-=e,h.height+=i+e)}this.__updateNaturalSize()}else super.__updateBoxBounds();i&&(h.width+=.16*s);const l=oh(h,a)?h:a;nh(l,e.contentBounds)?t.__textBoxBounds=l:(e.contentBounds=l,e.renderChanged=!0,hh(t.__textBoxBounds={},[h,a]))}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.__layout.boxBounds===this.__layout.contentBounds?0:1),t}__updateRenderBounds(){rh(this.__layout.renderBounds,this.__.__textBoxBounds,this.__layout.renderSpread)}};Xn([Rr(class extends ea{get __useNaturalRatio(){return!1}setFontWeight(t){"string"==typeof t?(this.__setInput("fontWeight",t),this._fontWeight=na[t]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t)}})],lh.prototype,"__",void 0),Xn([fr(0)],lh.prototype,"width",void 0),Xn([fr(0)],lh.prototype,"height",void 0),Xn([ur(!1)],lh.prototype,"resizeFontSize",void 0),Xn([kr("#000000")],lh.prototype,"fill",void 0),Xn([wr("outside")],lh.prototype,"strokeAlign",void 0),Xn([Cr("all")],lh.prototype,"hitFill",void 0),Xn([fr("")],lh.prototype,"text",void 0),Xn([fr("L")],lh.prototype,"fontFamily",void 0),Xn([fr(12)],lh.prototype,"fontSize",void 0),Xn([fr("normal")],lh.prototype,"fontWeight",void 0),Xn([fr(!1)],lh.prototype,"italic",void 0),Xn([fr("none")],lh.prototype,"textCase",void 0),Xn([fr("none")],lh.prototype,"textDecoration",void 0),Xn([fr(0)],lh.prototype,"letterSpacing",void 0),Xn([fr({type:"percent",value:1.5})],lh.prototype,"lineHeight",void 0),Xn([fr(0)],lh.prototype,"paraIndent",void 0),Xn([fr(0)],lh.prototype,"paraSpacing",void 0),Xn([fr("left")],lh.prototype,"textAlign",void 0),Xn([fr("top")],lh.prototype,"verticalAlign",void 0),Xn([fr(!0)],lh.prototype,"autoSizeAlign",void 0),Xn([fr("normal")],lh.prototype,"textWrap",void 0),Xn([fr("show")],lh.prototype,"textOverflow",void 0),lh=Xn([Wr()],lh);let dh=class extends ua{get __tag(){return"Path"}constructor(t){super(t)}};Xn([Rr(class extends ea{get __pathInputed(){return 2}})],dh.prototype,"__",void 0),Xn([wr("center")],dh.prototype,"strokeAlign",void 0),dh=Xn([Wr()],dh);let _h=class extends pa{get __tag(){return"Pen"}constructor(t){super(t)}setStyle(t){const e=this.pathElement=new dh(t);return this.pathStyle=t,this.__path=e.path||(e.path=[]),this.add(e),this}beginPath(){return this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,s,i,r,o){return this}quadraticCurveTo(t,e,s,i){return this}closePath(){return this}rect(t,e,s,i){return this}roundRect(t,e,s,i,r){return this}ellipse(t,e,s,i,r,o,n,a){return this}arc(t,e,s,i,r,o){return this}arcTo(t,e,s,i,r){return this}drawEllipse(t,e,s,i,r,o,n,a){return this}drawArc(t,e,s,i,r,o){return this}drawPoints(t,e,s){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};function uh(t,e,s,i){var r,o=arguments.length,n=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(o<3?r(n):o>3?r(e,s,n):r(e,s))||n);return o>3&&n&&Object.defineProperty(e,s,n),n}Xn([Rr(class extends sa{})],_h.prototype,"__",void 0),Xn([(t,e)=>{lr(t,e,{get(){return this.__path}})}],_h.prototype,"path",void 0),_h=Xn([Mr(Qs,["set","path","paint"]),Wr()],_h),"function"==typeof SuppressedError&&SuppressedError;let ch=class extends Fa{get __tag(){return"Arrow"}constructor(t){super(t),this.__.__useArrow=!0}};uh([Rr(class extends ra{})],ch.prototype,"__",void 0),uh([br("angle")],ch.prototype,"endArrow",void 0),ch=uh([Wr()],ch);const{M:ph,L:gh,C:yh,Q:fh,O:mh}=Ht,{rotate:xh,copyFrom:wh,scale:vh}=M,bh={},Bh={layout(t,e,s,i,r,o,n){let a,h,l=0,d=t.length;for(;l<d;)switch(a=t[l],a){case ph:case gh:kh(t,l+1,e,s,i,r,o,n),l+=3;break;case yh:for(h=1;h<6;h+=2)kh(t,l+h,e,s,i,r,o,n);l+=7;break;case fh:for(h=1;h<4;h+=2)kh(t,l+h,e,s,i,r,o,n);l+=5;break;case mh:t[l+1]+=e,t[l+2]+=s,i&&(t[l+3]*=i),o&&(t[l+4]+=o,t[l+5]+=o),l+=7}},rotate(t,e,s){Bh.layout(t,0,0,1,1,e,s)}};function kh(t,e,s,i,r,o,n,a){wh(bh,t[e],t[e+1]),n&&xh(bh,n,a),r&&vh(bh,r,o),t[e]=s+bh.x,t[e+1]=i+bh.y}const{layout:Oh,rotate:Ch}=Bh,{getAngle:Rh}=M,Th={x:-.5},Ph={connect:Th,offset:{x:-.71,bevelJoin:.36,roundJoin:.22},path:[1,-3,-3,2,0,0,2,-3,3]},Sh={connect:Th,offset:{x:-1.207,bevelJoin:.854,roundJoin:.707},path:[1,-3,-3,2,0,0,2,-1,0]},Eh={connect:Th,offset:{x:-.9,bevelJoin:.624,roundJoin:.4},path:[1,-3,0,2,-3,-2,2,0,0,2,-3,2,2,-3,0,1,-2.05,1.1,2,-2.05,-1.1]},Ah={connect:Th,offset:{x:-1.1,bevelJoin:.872,roundJoin:.6},path:[1,-3,0,2,-3.5,-1.8,2,0,0,2,-3.5,1.8,2,-3,0,1,-2.25,.95,2,-2.25,-.95]},Lh={offset:Th,path:[...Eh.path]};Ch(Lh.path,180,{x:-1.5,y:0});const Ih={connect:{x:-1.3},path:[1,1.8,-.1,2,1.8,0,26,0,0,1.8,0,359,0]},Mh={connect:{x:.5},path:[...Ih.path,1,0,0,26,0,0,1,0,360,0]},Wh={connect:{x:-1.3},path:[1,-1.4,0,2,-1.4,-1.4,2,1.4,-1.4,2,1.4,1.4,2,-1.4,1.4,2,-1.4,0]},Dh={path:[...Wh.path,2,-1.4,-.49,2,1,-.49,1,-1.4,.49,2,1,.49]},Nh=Et.clone(Wh),Fh=Et.clone(Dh);Ch(Nh.path,45),Ch(Fh.path,45);const Yh={angle:Ph,"angle-side":Sh,arrow:Ah,triangle:Eh,"triangle-flip":Lh,circle:Mh,"circle-line":Ih,square:Dh,"square-line":Wh,diamond:Fh,"diamond-line":Nh,mark:{offset:Th,path:[1,0,-2,2,0,2]}};function Xh(t,e,s,i,r,o){const{strokeCap:n,strokeJoin:a}=t.__,{offset:h,connect:l,path:d}="object"==typeof e?e:Yh[e];let _=l?l.x:0,u=h?h.x:0;const c=[...d];return"none"!==n&&(_-=.5),h&&("round"===a&&h.roundJoin?u+=h.roundJoin:"bevel"===a&&h.bevelJoin&&(u+=h.bevelJoin)),u&&Oh(c,u,0),Oh(c,i.x,i.y,r,r,Rh(s,i)),o.x=(_+u)*r,c}const{M:zh,L:Gh,C:jh,Q:Hh,Z:Vh,N:Uh,D:qh,X:Jh,G:Qh,F:Zh,O:$h,P:Kh,U:tl}=Ht,{copy:el,copyFrom:sl,getDistancePoint:il}=M,rl={},ol={},nl={},al={},hl={},ll={list:Yh,addArrows(t,e){const{startArrow:s,endArrow:i,strokeWidth:r,__pathForRender:o}=t.__;let n,a=0,h=o.length,l=0,d=s&&"none"!==s;for(;a<h;){switch(n=o[a],n){case zh:case Gh:(l<2||a+6>=h)&&(sl(hl,o[a+1],o[a+2]),!l&&d&&el(ol,hl)),a+=3;break;case jh:1!==l&&a+7!==h||dl(o,al,hl,a+3),a+=7;break;case Hh:1!==l&&a+5!==h||dl(o,al,hl,a+1),a+=5;break;case Vh:return;case Uh:a+=5;break;case qh:a+=9;break;case Jh:a+=6;break;case Qh:a+=9;break;case Zh:a+=5;break;case $h:a+=7;break;case Kh:a+=4;break;case tl:1!==l&&a+6!==h||dl(o,al,hl,a+1),a+=6}if(l++,1===l&&n!==zh)return;if(2===l&&d&&el(nl,n===Gh?hl:al),a===h){const h=t.__.__pathForRender=e?[...o]:o;if(d&&(h.push(...Xh(t,s,nl,ol,r,rl)),rl.x&&(il(ol,nl,-rl.x,!0),h[1]=nl.x,h[2]=nl.y)),i&&"none"!==i&&(h.push(...Xh(t,i,al,hl,r,rl)),rl.x)){let t;switch(il(hl,al,-rl.x,!0),n){case Gh:t=a-3+1;break;case jh:t=a-7+5;break;case Hh:t=a-5+3;break;case tl:t=a-6+3}t&&_l(h,al,t)}}else el(al,hl)}}};function dl(t,e,s,i){sl(e,t[i],t[i+1]),sl(s,t[i+2],t[i+3])}function _l(t,e,s){t[s]=e.x,t[s+1]=e.y}function ul(t){return _r(t,(t=>({set(e){if(this.__setAttr(t,e)){const t=this.__;t.__useArrow="none"!==t.startArrow||"none"!==t.endArrow,vr(this)}}})))}const cl=ua.prototype;var pl,gl;ul("none")(cl,"startArrow"),ul("none")(cl,"endArrow"),Object.assign(Vn,ll),function(t){t.LEFT="left",t.RIGHT="right",t.TOP="top",t.BOTTOM="bottom",t.CENTER_X="centerX",t.CENTER_Y="centerY",t.LEFT_OVERLAP="leftOverlap",t.RIGHT_OVERLAP="rightOverlap",t.TOP_OVERLAP="topOverlap",t.BOTTOM_OVERLAP="bottomOverlap",t.TARGET_CENTER_Y_TOP="targetCenterYTop",t.TARGET_CENTER_Y_BOTTOM="targetCenterYBottom",t.TARGET_CENTER_X_LEFT="targetCenterXLeft",t.TARGET_CENTER_X_RIGHT="targetCenterXRight"}(pl||(pl={})),function(t){t.LEFT="l2r",t.RIGHT="r2l",t.TOP="t2b",t.BOTTOM="b2t"}(gl||(gl={}));const yl="rgb(255,0,0)";class fl{constructor(e,s,i){this.app=e,this.referenceLeafer=e.addLeafer(),this.gutterOptions={showGutter:!s.hasOwnProperty("showGutter")||s.showGutter,showGutterNum:s.showGutterNum||5,fill:s.fill||yl,fontSize:s.fontSize||12,stroke:s.stroke||yl,strokeWidth:s.strokeWidth||2,startArrow:s.startArrow||"mark",endArrow:s.endArrow||"mark",gutterAdsorption:s.gutterAdsorption||6,gutterArr:s.gutterArr||[12,32,64,128],showBg:!s.hasOwnProperty("showBg")||s.showBg,bgColor:s.bgColor||"rgba(255,156,156,0.16)"},this.lineOptions={showLine:!i.hasOwnProperty("showLine")||i.showLine,showLineNum:i.showLineNum||5,adsorption:i.adsorption||10,stroke:i.stroke||yl,strokeWidth:i.strokeWidth||1},this.pointMap=new Map,this.zoomHandler=this.zoomHandler.bind(this),this.app.tree.on(t.ZOOM,this.zoomHandler),this.treeListen(e.tree),this.initCenterMap()}initCenterMap(){this.app.tree.children.forEach((t=>{const e=this.getPoints(t.getBounds("content","page"));this.pointMap.set(t.innerId,e)}))}getPoints(t){return{centerX:t.x+t.width/2,centerY:t.y+t.height/2,x:t.x,y:t.y,x1:t.x+t.width,y1:t.y+t.height}}getXOffset(t){const e=Math.min(...t.map((t=>t.x)));return t[0].x-e}getYOffset(t){const e=Math.min(...t.map((t=>t.y)));return t[0].y-e}getXOffset1(t){const e=Math.max(...t.map((t=>t.x)));return e-t[0].x}getYOffset1(t){const e=Math.max(...t.map((t=>t.y)));return e-t[0].y}drawLine(t,s,i,r){const o=this.getPoints(r.getBounds("content","page")),n=this.getXOffset(r.getLayoutPoints("content","page")),a=this.getYOffset(r.getLayoutPoints("content","page"));if("row"===t)switch(this.line=new e({x:-1e4,y:s,width:2e4,strokeWidth:this.lineOptions.strokeWidth,stroke:this.lineOptions.stroke}),i){case pl.TOP:case pl.BOTTOM_OVERLAP:r.y=s+a;break;case pl.BOTTOM:case pl.TOP_OVERLAP:r.y=s-(o.y1-o.y)+a;break;case pl.CENTER_Y:case pl.TARGET_CENTER_Y_TOP:case pl.TARGET_CENTER_Y_BOTTOM:r.y=s-(o.y1-o.y)/2+a}else switch(this.line=new e({x:s,y:-1e4,width:2e4,rotation:90,strokeWidth:1,stroke:this.lineOptions.stroke}),i){case pl.CENTER_X:case pl.TARGET_CENTER_X_LEFT:case pl.TARGET_CENTER_X_RIGHT:r.x=s-(o.x1-o.x)/2+n;break;case pl.LEFT:case pl.LEFT_OVERLAP:r.x=s+n;break;case pl.RIGHT:case pl.RIGHT_OVERLAP:r.x=s-(o.x1-o.x)+n}this.referenceLeafer.add(this.line)}drawArrow(t,e){const r=this.getXOffset(e.getLayoutPoints("content","page")),o=this.getYOffset(e.getLayoutPoints("content","page")),n=this.getXOffset1(e.getLayoutPoints("content","page")),a=this.getYOffset1(e.getLayoutPoints("content","page"));let h,l,d;if("row"===t.type?(h=new ch({x:t.x,y:t.y,width:t.gutter,strokeWidth:this.gutterOptions.strokeWidth,startArrow:this.gutterOptions.startArrow,endArrow:this.gutterOptions.endArrow,stroke:this.gutterOptions.stroke}),t.position===gl.LEFT?e.x=t.x-n:e.x=t.x+t.gutter+r,l=new s({x:t.x+t.gutter/2,y:t.y,fill:this.gutterOptions.fill,fontSize:this.gutterOptions.fontSize,textAlign:"center",text:t.gutter.toString()}),d={width:t.gutter,height:2e4,y:-1e4,x:t.x,fill:this.gutterOptions.bgColor,zIndex:-1}):"vertical"===t.type&&(h=new ch({x:t.x,y:t.y,width:t.gutter,rotation:90,strokeWidth:this.gutterOptions.strokeWidth,startArrow:this.gutterOptions.startArrow,endArrow:this.gutterOptions.endArrow,stroke:this.gutterOptions.stroke}),t.position===gl.TOP?e.y=t.y-a:e.y=t.y+t.gutter+o,l=new s({x:t.x+this.gutterOptions.fontSize,y:t.y+t.gutter/2-1.5*this.gutterOptions.fontSize/2,fill:this.gutterOptions.fill,fontSize:this.gutterOptions.fontSize,textAlign:"center",text:t.gutter.toString()}),d={width:2e4,x:-1e4,height:t.gutter,y:t.y,fill:this.gutterOptions.bgColor,zIndex:-1}),this.referenceLeafer.add(h),l&&this.referenceLeafer.add(l),this.gutterOptions.showBg){const t=new i(d);this.referenceLeafer.add(t)}}getCloseEle(t,e,s){let i=[];const r=[],o=[];this.pointMap.forEach(((t,i)=>{if(i!==e.innerId){const e=Math.sqrt(Math.pow(t.centerX-s.centerX,2)+Math.pow(t.centerY-s.centerY,2));o.push({point:t,distance:e})}})),o.sort(((t,e)=>t.distance-e.distance));for(let e=0;e<Math.min(t,o.length);e++)r.push(o[e].point);return i=r,console.log("closestPoints"),console.log(i),i}treeListen(t){t.on(r.DRAG,(t=>{this.referenceLeafer.clear(),this.lineOptions.showLine&&this.calcOverlap(t.target),this.gutterOptions.showGutter&&this.calcGutter(t.target)})),t.on(r.END,(()=>{this.referenceLeafer.clear(),this.initCenterMap()}))}calcOverlap(t){const e=this.getPoints(t.getBounds("content","page")),s=[];this.getCloseEle(this.lineOptions.showLineNum,t,e).forEach(((i,r)=>{r!==t.innerId&&(Math.abs(i.x-e.x)<=this.lineOptions.adsorption&&s.push({type:"vertical",value:i.x,position:pl.LEFT}),Math.abs(i.x1-e.x1)<=this.lineOptions.adsorption&&s.push({type:"vertical",value:i.x1,position:pl.RIGHT}),Math.abs(i.y-e.y)<=this.lineOptions.adsorption&&s.push({type:"row",value:i.y,position:pl.TOP}),Math.abs(i.y1-e.y1)<=this.lineOptions.adsorption&&s.push({type:"row",value:i.y1,position:pl.BOTTOM}),Math.abs(i.centerX-e.centerX)<=this.lineOptions.adsorption&&s.push({type:"vertical",value:i.centerX,position:pl.CENTER_X}),Math.abs(i.centerY-e.centerY)<=this.lineOptions.adsorption&&s.push({type:"row",value:i.centerY,position:pl.CENTER_Y}),Math.abs(i.x-e.x1)<=this.lineOptions.adsorption&&s.push({type:"vertical",value:i.x,position:pl.RIGHT_OVERLAP}),Math.abs(i.x1-e.x)<=this.lineOptions.adsorption&&s.push({type:"vertical",value:i.x1,position:pl.LEFT_OVERLAP}),Math.abs(i.y-e.y1)<=this.lineOptions.adsorption&&s.push({type:"row",value:i.y,position:pl.TOP_OVERLAP}),Math.abs(i.y1-e.y)<=this.lineOptions.adsorption&&s.push({type:"row",value:i.y1,position:pl.BOTTOM_OVERLAP}),Math.abs(e.centerY-i.y)<=this.lineOptions.adsorption&&s.push({type:"row",value:i.y,position:pl.TARGET_CENTER_Y_TOP}),Math.abs(e.centerY-i.y1)<=this.lineOptions.adsorption&&s.push({type:"row",value:i.y1,position:pl.TARGET_CENTER_Y_BOTTOM}),Math.abs(e.centerX-i.x)<=this.lineOptions.adsorption&&s.push({type:"vertical",value:i.x,position:pl.TARGET_CENTER_X_LEFT}),Math.abs(e.centerX-i.x1)<=this.lineOptions.adsorption&&s.push({type:"vertical",value:i.x1,position:pl.TARGET_CENTER_X_RIGHT}))})),s.forEach((e=>{this.drawLine(e.type,e.value,e.position,t)}))}calcGutter(t){const e=[],s=this.getPoints(t.getBounds("content","page"));this.getCloseEle(this.gutterOptions.showGutterNum,t,s).forEach(((i,r)=>{r!==t.innerId&&this.gutterOptions.gutterArr.forEach((t=>{Math.abs(i.x-s.x1-t)<=this.gutterOptions.gutterAdsorption&&e.push({gutter:t,position:gl.LEFT,type:"row",x:i.x-t,y:s.centerY}),Math.abs(s.x-i.x1-t)<=this.gutterOptions.gutterAdsorption&&e.push({gutter:t,position:gl.RIGHT,type:"row",x:i.x1,y:s.centerY}),Math.abs(i.y-s.y1-t)<=this.gutterOptions.gutterAdsorption&&e.push({gutter:t,position:gl.TOP,type:"vertical",x:s.centerX,y:i.y-t}),Math.abs(s.y-i.y1-t)<=this.gutterOptions.gutterAdsorption&&e.push({gutter:t,position:gl.BOTTOM,type:"vertical",x:s.centerX,y:i.y1})}))})),e.forEach((e=>{this.drawArrow(e,t)}))}zoomHandler(){this.initCenterMap()}changeGutterStatus(t){this.gutterOptions.showGutter=t}changeLineStatus(t){this.lineOptions.showLine=t}}export{fl as ReferenceLine};
